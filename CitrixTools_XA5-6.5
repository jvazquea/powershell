#Generated Form Function
$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
asnp Citrix.*

Add-Type -Name Window -Namespace Console -MemberDefinition '
[DllImport("Kernel32.dll")]
public static extern IntPtr GetConsoleWindow();
 
[DllImport("user32.dll")]
public static extern bool ShowWindow(IntPtr hWnd, Int32 nCmdShow);
'

function Show-Console {
   $consolePtr = [Console.Window]::GetConsoleWindow()
  #5 show
 [Console.Window]::ShowWindow($consolePtr, 5)
}

function Hide-Console {
    $consolePtr = [Console.Window]::GetConsoleWindow()
  #0 hide
 [Console.Window]::ShowWindow($consolePtr, 0)
}

$x = @()
function GenerateForm {
########################################################################
# Code Generated By: SAPIEN Technologies PrimalForms (Community Edition) v1.0.10.0
# Generated On: 07/08/2015 9:49
# Generated By: Javier Vázquez Martín
########################################################################

#region Import the Assemblies
[reflection.assembly]::loadwithpartialname("System.Windows.Forms") | Out-Null
[reflection.assembly]::loadwithpartialname("System.Drawing") | Out-Null
#endregion

#region Generated Form Objects
$form1 = New-Object System.Windows.Forms.Form
$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState

#tabs
$Permisos = New-Object System.Windows.Forms.TabControl
$Users_tab = New-Object System.Windows.Forms.TabPage
$PublishNew = New-Object System.Windows.Forms.TabPage
$servers_wg = New-Object System.Windows.Forms.TabPage
$Searchtab = New-Object System.Windows.Forms.TabPage

#labels
$lab_app_users = New-Object System.Windows.Forms.Label
$lab_usr_dom = New-Object System.Windows.Forms.Label
$lab_srvs = New-Object System.Windows.Forms.Label
$WorkingDir = New-Object System.Windows.Forms.Label
$Command_Line_Lab = New-Object System.Windows.Forms.Label
$Cli_app_folder_lab = New-Object System.Windows.Forms.Label
$label2 = New-Object System.Windows.Forms.Label
$AppDescription_lab = New-Object System.Windows.Forms.Label
$DisplayName_lab = New-Object System.Windows.Forms.Label
$lab_srch_field = New-Object System.Windows.Forms.Label
$lab_search_by = New-Object System.Windows.Forms.Label
$lab_app_list = New-Object System.Windows.Forms.Label
$lab_workergroup = New-Object System.Windows.Forms.Label
$publishedinserver = New-Object System.Windows.Forms.Label

#textbox
$Dom_group = New-Object System.Windows.Forms.TextBox
$Groups_app = New-Object System.Windows.Forms.TextBox
$App_server = New-Object System.Windows.Forms.TextBox
$Dir_App = New-Object System.Windows.Forms.TextBox
$pkg_cmd = New-Object System.Windows.Forms.TextBox
$Cli_App_Folder = New-Object System.Windows.Forms.TextBox
$App_Description = New-Object System.Windows.Forms.TextBox
$DisplayName = New-Object System.Windows.Forms.TextBox
$txt_search = New-Object System.Windows.Forms.TextBox
$app_list_search = New-Object System.Windows.Forms.TextBox

#buttons
$Refresh = New-Object System.Windows.Forms.Button
$exp_perm_file = New-Object System.Windows.Forms.Button
$Permissions_app = New-Object System.Windows.Forms.Button
$Remove = New-Object System.Windows.Forms.Button
$Add = New-Object System.Windows.Forms.Button
$exp_app_srv = New-Object System.Windows.Forms.Button
$Perm_server = New-Object System.Windows.Forms.Button
$Check_srv = New-Object System.Windows.Forms.Button
$Uncheck_srv = New-Object System.Windows.Forms.Button
$Publish = New-Object System.Windows.Forms.Button
$Unpublish = New-Object System.Windows.Forms.Button
$Publish_New_App = New-Object System.Windows.Forms.Button
$Check_app = New-Object System.Windows.Forms.Button
$Uncheck_app = New-Object System.Windows.Forms.Button
$chk_search = New-Object System.Windows.Forms.Button
$but_Search = New-Object System.Windows.Forms.Button
$but_clear_field = New-Object System.Windows.Forms.Button

$Enable_app = New-Object System.Windows.Forms.Button

$farm=get-xafarm

IF ($farm.serverversion.major -ge 6) {
$Remove_Srv_WG = New-Object System.Windows.Forms.Button
$add_srv_WG = New-Object System.Windows.Forms.Button
$wg_members = New-Object System.Windows.Forms.Button
$chk_workgroup = New-Object System.Windows.Forms.Button
$unchk_workgroup = New-Object System.Windows.Forms.Button
}
#checkedlistboxes
$Servers_list = New-Object System.Windows.Forms.CheckedListBox
$Applications = New-Object System.Windows.Forms.CheckedListBox
IF ($farm.serverversion.major -ge 6) {
$WG_list = New-Object System.Windows.Forms.CheckedListBox
}
#radiobuttons
$Streamed_App = New-Object System.Windows.Forms.RadioButton
$Local_App = New-Object System.Windows.Forms.RadioButton
$disa_console = New-Object System.Windows.Forms.RadioButton
$ena_console = New-Object System.Windows.Forms.RadioButton

#combobox
$Comb_search_by = New-Object System.Windows.Forms.ComboBox

#tooltip
$balloons = New-Object System.Windows.Forms.ToolTip

#endregion Generated Form Objects

$balloons.add_Popup($handler_toolTip1_Popup)
$balloons.SetToolTip($Refresh, "Reload all farm data")
$balloons.SetToolTip($exp_perm_file, "Export permissions field to file")
$balloons.SetToolTip($Permissions_app, "Show Users and groups permissions from checked applications")
$balloons.SetToolTip($Remove, "Remove User or Group from checked applications")
$balloons.SetToolTip($Add, "Add User or Group to checked applications")
$balloons.SetToolTip($exp_app_srv, "Export application published on servers field to file")
$balloons.SetToolTip($Perm_server, "Show servers on which Applications are published")
$balloons.SetToolTip($Check_srv, "Check all servers")
$balloons.SetToolTip($Uncheck_srv, "Uncheck all servers")
$balloons.SetToolTip($Publish, "Publish checked applications in checked servers")
$balloons.SetToolTip($Unpublish, "Unpublish checked applications in checked servers")
$balloons.SetToolTip($Publish_New_App, "Create new application, without any servers and any users/groups. You can add servers/users from this script in Users and Servers Section. Finally, you can enable the application after updating data.")
$balloons.SetToolTip($Check_app, "Check all applications")
$balloons.SetToolTip($Uncheck_app, "Uncheck all applications")
$balloons.SetToolTip($chk_search, "Check applications from search")
$balloons.SetToolTip($but_Search, "Search Applications from Server or Domain User/group")
$balloons.SetToolTip($Enable_app, "Enable checked applications")
$balloons.SetToolTip($but_clear_field, "Clear User/Groups field")
$balloons.SetToolTip($disa_console, "Hide Powershell Console")
$balloons.SetToolTip($ena_console, "Show Powershell Console")


IF ($farm.serverversion.major -ge 6) {
$balloons.SetToolTip($wg_members, "Show Worker groups server members")
$balloons.SetToolTip($chk_workgroup, "Check all applications")
$balloons.SetToolTip($unchk_workgroup, "Uncheck all applications")
$balloons.SetToolTip($Remove_Srv_WG, "Remove Server from Worker Group")
$balloons.SetToolTip($add_srv_WG, "Add Server to Worker Group")
}
#Import CSV with applications and permissions

If((Test-Path -path $scriptPath\apps.csv)) {
$apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
}
else {

$nombrefile="apps.csv"
$file = [string]"$scriptPath\$nombrefile"
$filetemp = [string]"$scriptPath\app-listtemp.csv"
$datos=Get-XAApplicationReport * | select @{n="ApplicationName";e={[string]::join(";", $_.Browsername)}}, @{n="UsersandGroups";e={[string]::join(" ; ", $_.Accounts)}}, @{n="Servers";e={[string]::join(" ; ", $_.ServerNames)}}, @{n="Enabled";e={[string]::join(" ; ", $_.Enabled)}}, @{n="Workergroups";e={[string]::join(" ; ", $_.WorkerGroupNames)}}


$datos|Export-Csv $file
get-content $file |select -Skip 1 |set-content "$filetemp"
move "$filetemp" $file -Force
$apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 

}

$servers=get-xaserver|sort-object Servername

    $n=0
    foreach($test in $servers)
    {
    $server=$servers[$n].Servername
    [void] $Servers_list.Items.Add("$server")
	
	$n=$n+1
    }
IF ($farm.serverversion.major -ge 6) {
$workgroups=get-XAWorkerGroup|sort-object WorkerGroupName

$n=0
    foreach($test in $workgroups)
    {
    $workgroup=$workgroups[$n].WorkerGroupName
    [void] $WG_list.Items.Add("$workgroup")
	
	$n=$n+1
    }
}
#----------------------------------------------
#Generated Event Script Blocks
#----------------------------------------------
#Provide Custom Code for events specified in PrimalForms.
$handler_label6_Click= 
{
#TODO: Place custom script here

}

$handler_button3_Click= 
{
#TODO: Place custom script here

}

$permission_app_Click= 
{

    $n=0
    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName, Enabled 
    $numero=$Applications.CheckedItems.count -1
    $permiso = (0 .. $numero)
    foreach ($objItem in $Applications.CheckedItems)
	{
	$app="$objItem"
	$datos = $apps|where {$_.ApplicationName -eq $app}|select UsersandGroups, Enabled
	$grupo = $datos.UsersandGroups
	$enabled = $datos.Enabled
    IF ($enabled -eq "True") {$state = "Enabled"}
	else {$state = "Disabled"}
	$permiso[$n] = "Application permissions " + $app + ": " + $state + "`r`n" + $grupo + "`r`n" + "`r`n"
	$n = $n + 1
	}

    $Groups_app.Text = $permiso
}

$handler_checkedListBox1_SelectedIndexChanged= 
{
#TODO: Place custom script here

}

$handler_Cli_app_folder_Click= 
{
#TODO: Place custom script here

}

$exp_app_srv_OnClick=
{
        if ($App_server.text -ne $empty) {
	set-content -path $scriptpath\app-servers.txt -value $App_server.text
        }
}

$Check_app_OnClick= 
{

        for ($i=0;$i -lt $Applications.Items.count;$i++) {
            $Applications.SetItemchecked($i,$True)
        }
    
}

$Uncheck_srv_OnClick= 
{
        for ($i=0;$i -lt $Servers_list.Items.count;$i++) {
            $Servers_list.SetItemchecked($i,$False)
        }
    
}
$chk_workgroup_OnClick=
{
        for ($i=0;$i -lt $WG_list.Items.count;$i++) {
            $WG_list.SetItemchecked($i,$True)
        }
}
$unchk_workgroup_OnClick=
{
        for ($i=0;$i -lt $WG_list.Items.count;$i++) {
            $WG_list.SetItemchecked($i,$False)
        }
}
$handler_textBox1_TextChanged= 
{
#TODO: Place custom script here

}

$exp_perm_file_OnClick= 
{
        if ($Groups_app.Text -ne $empty) {
	set-content -path $scriptpath\app-groups.txt -value $Groups_app.Text
        }
    
}

$handler_label2_Click= 
{
#TODO: Place custom script here

}

$uncheck_app_Click= 
{
        for ($i=0;$i -lt $Applications.Items.count;$i++) {
            $Applications.SetItemchecked($i,$False)
        }
    
}

$Check_srv_OnClick= 
{
        for ($i=0;$i -lt $Servers_list.Items.count;$i++) {
            $Servers_list.SetItemchecked($i,$True)
        }
    
}

$Add_Click= 
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    IF ($Dom_group.Text -lt 0) {
	$message = "Empty field" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
   	$wshell.Popup($message,0,"Write a group name",0x0)
	} else {
              $i=0
	      foreach ( $objItem in $Applications.CheckedItems ) {
	      $app="$objItem"
	      $groups = $Dom_group.Text
		  $groups=$groups -replace (" ; ",";")
	      $groups=$groups -replace (" ;",";")
		  $groups=$groups -replace ("; ",";")
		  $groups=$groups.Split(';')
		  Add-XAApplicationAccount $app -accounts $groups -force
	      $applicationchecked[$i]=$app
          $i++
	      }
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"User/group addded " + $groups + " to applications " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x0)
    }
  
}

$Remove_OnClick= 
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    IF ($Dom_group.Text -lt 0) {
	$message = "Empty field" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
   	$wshell.Popup($message,0,"Write a group name",0x0)
	} else {
        $i=0
        foreach ($objItem in $Applications.CheckedItems)
	    {
           $app="$objItem"
           $groups = $Dom_group.Text
	       $a = new-object -comobject wscript.shell
	       $Pregunta = $a.popup("Are you sure to remove permission in $app to the user/group?", 0,"Delete Files",4)
	       If ($Pregunta -eq 6) {
		       $groups=$groups -replace (" ; ",";")
	           $groups=$groups -replace (" ;",";")
		       $groups=$groups -replace ("; ",";")
		       $groups=$groups.Split(';')
	           Remove-XAApplicationAccount $app -accounts $groups
	           $applicationchecked[$i]=$app
               $i++
	     }
	}
	   if ($i -eq 0){
	      $message = [string]"Cancelado"
	      $wshell = New-Object -ComObject Wscript.Shell
              $wshell.Popup($message,0,"Done",0x0)
           } else {
           $i--
	   $applicationchecked=$applicationchecked[0..$i]
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"User/group removed " + $groups + " to applications " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x0)
}
}
}

$handler_textBox4_TextChanged= 
{
#TODO: Place custom script here

}

$Publish_OnClick= 
{
	$apps=$Applications.CheckedItems
	$capps=$apps.count -1
	$servers=$Servers_list.CheckedItems
	$cservers=$servers.count -1
	$resapps=(0..$capps)
	$resservers=(0..$cservers)
	$farm=get-xafarm

    IF ($farm.serverversion.major -ge 6) {
	   $wgs=$WG_list.CheckedItems
	   $cwgs=$wgs.count -1
	   $reswg=(0..$cwgs)
	}
	
	$j=0
	foreach ( $objItem in $Applications.CheckedItems ) {
	$i=0
	$k=0
	$app="$objItem"
	$resapps[$j]=$app
	$j++
	IF ($Servers_list.CheckedItems -gt 0){
	foreach ( $objServer in $Servers_list.CheckedItems ) {
           $server="$objServer"
	       Add-XAApplicationServer -BrowserName $app -ServerNames $server
	       $resservers[$i]=$server
           $i++
	   }
	}
	IF ($farm.serverversion.major -ge 6) {
	   IF ($WG_list.CheckedItems -gt 0){
	   foreach ( $objwg in $WG_list.CheckedItems ) {
           $wg="$objwg"
	       Add-XAApplicationWorkerGroup -BrowserName $app -WorkerGroupNames $wg
	       $reswg[$k]=$wg
           $k++
	   }
	}
	}
	}
	$resservers=$resservers|out-string
	$reswg=$reswg|out-string
	$resapps=$resapps|out-string
	IF ($farm.serverversion.major -ge 6) {
	   $message = [string]"Server/s: " + "$resservers" + "`r" + "Worker Groups: " + "$reswg" + " added to Application/s " + "$resapps" + "`r`n"
	}
	else {
	   $message = [string]"Server/s " + "$resservers"+ " added to Application/s " + "$resapps" + "`r`n"
	}
	$wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x0)
}

$Unpublish_OnClick= 
{
	$apps=$Applications.CheckedItems
	$capps=$apps.count -1
	$servers=$Servers_list.CheckedItems
	$cservers=$servers.count -1
	$resapps=(0..$capps)
	$resservers=(0..$cservers)
	IF ($farm.serverversion.major -ge 6) {
	   $wgs=$WG_list.CheckedItems
	   $cwgs=$wgs.count -1
	   $reswg=(0..$cwgs)
	}
	$j=0
	$a = new-object -comobject wscript.shell
	IF ($farm.serverversion.major -ge 6) {
	$Pregunta = $a.popup("Are you sure to remove permission in $app to the Servers and/or Worker Group Selected?", 0,"Delete Permission",4)
	}
	else {
	$Pregunta = $a.popup("Are you sure to remove permission in $app to the Servers Selected?", 0,"Delete Permission",4)
	}
	If ($Pregunta -eq 6) {
		foreach ( $objItem in $Applications.CheckedItems ) {
		$i=0
		$k=0
		$app="$objItem"
		$resapps[$j]=$app
		$j++
		IF ($Servers_list.CheckedItems -gt 0){
		   foreach ( $objServer in $Servers_list.CheckedItems ) {
             		$server="$objServer"
	     		    Remove-XAApplicationServer -BrowserName $app -ServerNames $server
	    		    $resservers[$i]=$server
             		$i++
		   }
		}
	   IF ($farm.serverversion.major -ge 6) {
	       IF ($WG_list.CheckedItems -gt 0){
	           foreach ( $objwg in $WG_list.CheckedItems ) {
                   $wg="$objwg"
	               Remove-XAApplicationWorkerGroup -BrowserName $app -WorkerGroupNames $wg
	               $reswg[$k]=$wg
                   $k++
	           }
	       }
	   }
	   }
	}
	$resservers=$resservers|out-string
	$resapps=$resapps|out-string
    IF ($farm.serverversion.major -ge 6) {
	   $message = [string]"Server/s: " + "$resservers" + "`r" + "Worker Groups: " + "$reswg" + " removed to Application/s " + "$resapps" + "`r`n"
	}
	else {
	   $message = [string]"Server/s " + "$resservers"+ " removed to Application/s " + "$resapps" + "`r`n"
	}
	$wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x0)
}

$Publish_New_App_OnClick= 
{
   If ($Local_App.Checked -eq $true)
   {
      $xafarm=Get-XAfarm
      If ($xafarm.serverversion.major -lt "6")
      {
      New-XAApplication $Displayname.text -ApplicationType ServerInstalled -CommandLineExecutable $pkg_cmd.text -WorkingDirectory $Dir_App.text -ClientFolder $Cli_App_Folder.text -ColorDepth "Highcolor" -AudioType None -AudioRequired $False -AddToClientStartMenu $False -WindowType "1024x768" -HideWhenDisabled $True
      }
      else {
      	New-XAApplication $Displayname.text -ApplicationType ServerInstalled -CommandLineExecutable $pkg_cmd.text -WorkingDirectory $Dir_App.text -ClientFolder $Cli_App_Folder.text -ColorDepth "Colors16Bit" -AudioType None -AudioRequired $False -AddToClientStartMenu $False -WindowType "1024x768" -HideWhenDisabled $True  
		}
	}
   else {
      $xafarm=Get-XAfarm
      If ($xafarm.serverversion.major -lt "6")
	  {
      New-XAApplication $Displayname.text -ApplicationType StreamedToServer -ProfileLocation $pkg_cmd.text -ProfileProgramName $Dir_App.text -ClientFolder $Cli_App_Folder.text -ColorDepth "Highcolor" -AudioType None -AudioRequired $False -AddToClientStartMenu $False -WindowType "1024x768" -HideWhenDisabled $True
	  }
	  else {
	  New-XAApplication $Displayname.text -ApplicationType StreamedToServer -ProfileLocation $pkg_cmd.text -ProfileProgramName $Dir_App.text -ClientFolder $Cli_App_Folder.text -ColorDepth "Colors16Bit" -AudioType None -AudioRequired $False -AddToClientStartMenu $False -WindowType "1024x768" -HideWhenDisabled $True
	  }
   }
   $message = "New aplication " + "$Displayname.text" + " published in the Farm"
   $wshell = New-Object -ComObject Wscript.Shell
   $wshell.Popup($message,0,"Done",0x0)
}

$Perm_server_OnClick=
{
   IF ($farm.serverversion.major -ge 6) {
       $n=0
       $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
       $numero=$Applications.CheckedItems.count -1
       $right = (0 .. $numero)
       foreach ($objItem in $Applications.CheckedItems)
	   {
	   $app="$objItem"
	   $servers = $apps|where {$_.ApplicationName -eq $app}|select Servers|sort-object Servers
	   $server = $servers.servers
	   $workergroups = $apps|where {$_.ApplicationName -eq $app}|select Workergroups|sort-object Workergroups
	   $Workergroup = $workergroups.Workergroups
	   if ($servers.servers -gt "0"){
	      if ($workergroups.Workergroups -gt "0"){
	         $right[$n] = "Application " + $app + " published in: " + "`r`n" + "Servers: " + $server + "`r`n" + "Worker groups: " + $Workergroup + "`r`n" + "`r`n"
	      }
		  else {
		  $right[$n] = "Application " + $app + " published in: " + "`r`n" + "Servers: " + $server + "`r`n" + "`r`n"
	      }
		}
		 else {
		    if ($workergroups.Workergroups -gt "0"){
			$right[$n] = "Application " + $app + " published in: " + "`r`n" + "Worker groups: " + $Workergroup + "`r`n" + "`r`n"
			}
			else {
			$right[$n] = "Application " + $app + " not published in any Server and any Work Group" + "`r`n" + "`r`n"
			}
		  }
		  $n++
	}

    $App_server.text = $right
    
   }
   else {
       $n=0
       $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
       $numero=$Applications.CheckedItems.count -1
       $right = (0 .. $numero)
       foreach ($objItem in $Applications.CheckedItems)
	   {
	   $app="$objItem"
	   $servers = $apps|where {$_.ApplicationName -eq $app}|select Servers|sort-object Servers
	   $server = $servers.servers
	   $right[$n] = "Application " + $app + " published in: " + "`r`n" + $server + "`r`n" + "`r`n"
	   $n++
	}

    $App_server.text = $right
    }
}


$Refresh_OnClick= 
{

    $nombrefile="apps.csv"
    $file = [string]"$scriptPath\$nombrefile"
    $filetemp = [string]"$scriptPath\app-listtemp.csv"
    $datos=Get-XAApplicationReport * | select @{n="ApplicationName";e={[string]::join(";", $_.Browsername)}}, @{n="UsersandGroups";e={[string]::join(" ; ", $_.Accounts)}}, @{n="Servers";e={[string]::join(";", $_.ServerNames)}}, @{n="Enabled";e={[string]::join(" ; ", $_.Enabled)}}, @{n="Workergroups";e={[string]::join(" ; ", $_.WorkerGroupNames)}}

   for ($i=0;$i -lt $datos.length;$i++) {

   if ($datos[$i].servers -gt 0) {
      $text=$datos[$i].servers.split("{;}")
      $text=$text|sort-object
      $cuenta=$text.count
      $prueba=$text -join " ; "
      $datos[$i].servers=$prueba
   }
   }

    $datos|Export-Csv $file
    get-content $file |select -Skip 1 |set-content "$filetemp"
    move "$filetemp" $file -Force
    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 

    $message = "Farm Data has been updated"
    $wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x0)
    
    $Applications.Items.clear()

    $n=0
    foreach($test in $apps)
    {
    $app=$apps[$n].ApplicationName
    [void] $Applications.Items.Add("$app")
    $n=$n+1
    }

    $Servers_list.Items.clear()
    
    $servers=get-xaserver|sort-object Servername

    $n=0
    foreach($test in $servers)
    {
    $server=$servers[$n].Servername
    [void] $Servers_list.Items.Add("$server")
    $n=$n+1
    }
IF ($farm.serverversion.major -ge 6) {
	$WG_list.Items.clear()
	
	$workgroups=get-XAWorkerGroup|sort-object WorkerGroupName
	
    $n=0
    foreach($test in $workgroups)
    {
    $workgroup=$workgroups[$n].WorkerGroupName
    [void] $WG_list.Items.Add("$workgroup")
	
	$n=$n+1
    }
}
}

$handler_TabPage_Click= 
{
#TODO: Place custom script here

}

$Local_App_OnClick=
{
$Command_Line_Lab.Text = "Command line:"
$WorkingDir.Text = "Working directory:"
}
$Streamed_App_OnClick=
{
$Command_Line_Lab.Text = "Citrix streaming application profile address:"
$WorkingDir.Text = "Application to launch from the Citrix streaming application profile:"
}

$but_Search_OnClick=
{
If ($txt_search.text -gt $null){
   If ($Comb_search_by.text -eq "User or group"){	   
	   $apps_csv = import-csv $scriptPath\apps.csv|sort-object ApplicationName
       $grpOrigen = $txt_search.text
       $permission = $apps_csv | where{$_.UsersandGroups -like "*$grpOrigen*"} | select ApplicationName
       $count = $permission.count
       $result = $permission|out-string
       $result = $result -replace ("ApplicationName","")
       $result = $result -replace ("---------------             ","")
       $result = $result -replace ("                                                                ","")        
       $result = $result -replace ("                                                   ","")
       $app_list_search.text = "Published applications for User/group " + $grpOrigen + " : " + $count + "`r`n" + "`r`n" +"Application List: " + $result
}
If ($Comb_search_by.text -eq "Server"){	   
	   $apps_csv = import-csv $scriptPath\apps.csv|sort-object ApplicationName
       $grpOrigen = $txt_search.text
       $permission = $apps_csv | where{$_.Servers -like "*$grpOrigen*"} | select ApplicationName
       $count = $permission.count
       $result = $permission|out-string
       $result = $result -replace ("ApplicationName","")
       $result = $result -replace ("---------------             ","")
       $result = $result -replace ("                                                                ","")        
       $result = $result -replace ("                                                   ","")
       $app_list_search.text = "Published applications for Server " + $grpOrigen + " : " + $count + "`r`n" + "`r`n" +"Application List: " + $result
}
IF ($farm.serverversion.major -ge 6) {
   If ($Comb_search_by.text -eq "Worker Group"){	   
	   $apps_csv = import-csv $scriptPath\apps.csv|sort-object ApplicationName
       $grpOrigen = $txt_search.text
       $permission = $apps_csv | where{$_.Workergroups -like "*$grpOrigen*"} | select ApplicationName
       $count = $permission.count
       $result = $permission|out-string
       $result = $result -replace ("ApplicationName","")
       $result = $result -replace ("---------------             ","")
       $result = $result -replace ("                                                                ","")        
       $result = $result -replace ("                                                   ","")
       $app_list_search.text = "Published applications for Worker Group " + $grpOrigen + " : " + $count + "`r`n" + "`r`n" +"Application List: " + $result
}
}
}
}

$chk_Search_OnClick=
{
If ($txt_search.text -gt $null){
   If ($Comb_search_by.text -eq "User or group"){	   
	   $apps_csv = import-csv $scriptPath\apps.csv|sort-object ApplicationName
       $grpOrigen = $txt_search.text
       $permission = $apps_csv | where{$_.UsersandGroups -like "*$grpOrigen*"} | select ApplicationName
	   for ($i=0;$i -lt $Applications.Items.count;$i++) {
          $Applications.SetItemchecked($i,$False)
       }
       $i=0
	   $count=$permission.count-1
	   $resapps=(0..$count)
	   $x=0
	   
	   foreach ($objitem in $Applications.items) {
	      foreach ($objitem2 in $permission) {
			$var1=$objitem|out-string
			$var2=$objitem2.applicationname|out-string
		    IF ($var1 -eq $var2) {

		     $resapps[$x]=$i
             #$Applications.SetItemchecked($i,$True)
			 $x++
		    }
		   }
	   $i++
	   }
	   foreach ($objitem in $resapps){
            $Applications.SetItemchecked($objitem,$True)
          }
   }
   If ($Comb_search_by.text -eq "Server"){
       $apps_csv = import-csv $scriptPath\apps.csv|sort-object ApplicationName
       $grpOrigen = $txt_search.text
       $permission = $apps_csv | where{$_.Servers -like "*$grpOrigen*"} | select ApplicationName
	   for ($i=0;$i -lt $Applications.Items.count;$i++) {
          $Applications.SetItemchecked($i,$False)
       }
       $i=0
	   $count=$permission.count-1
	   $resapps=(0..$count)
	   $x=0
	   
	   foreach ($objitem in $Applications.items) {
	      foreach ($objitem2 in $permission) {
			  $var1=$objitem|out-string
			  $var2=$objitem2.applicationname|out-string
		      IF ($var1 -eq $var2) {
                 $resapps[$x]=$i
                 $x++
		        }
		    }
	     $i++
	    }
	   foreach ($objitem in $resapps){
            $Applications.SetItemchecked($objitem,$True)
        }
    }
	If ($Comb_search_by.text -eq "Worker Group"){
	$apps_csv = import-csv $scriptPath\apps.csv|sort-object ApplicationName
       $grpOrigen = $txt_search.text
       $permission = $apps_csv | where{$_.WorkerGroups -like "*$grpOrigen*"} | select ApplicationName
	   for ($i=0;$i -lt $Applications.Items.count;$i++) {
          $Applications.SetItemchecked($i,$False)
       }
       $i=0
	   $count=$permission.count-1
	   $resapps=(0..$count)
	   $x=0
	   
	   foreach ($objitem in $Applications.items) {
	      foreach ($objitem2 in $permission) {
			  $var1=$objitem|out-string
			  $var2=$objitem2.applicationname|out-string
		      IF ($var1 -eq $var2) {
                 $resapps[$x]=$i
                 $x++
		        }
		    }
	     $i++
	    }
	   foreach ($objitem in $resapps){
            $Applications.SetItemchecked($objitem,$True)
        }
}
}
}

$add_srv_WG_OnClick = 
{
    $j=0
	$servers = $Servers_list.CheckedItems
	$wgs = $WG_list.CheckedItems
	$cservers = $servers.count -1
	$cwgs = $wgs.count -1
	$resservers = (0..$cservers)
	$reswgs = (0..$cwgs)
	foreach ( $objItem in $Servers_list.CheckedItems ) {
	   $i=0
	   $server="$objItem"
	   $resservers[$j]=$server
	   $j++
	   IF ($WG_list.CheckedItems -gt 0){
	       IF ($Servers_list.CheckedItems -gt 0){
	          foreach ( $objWG in $WG_list.CheckedItems ) {
                  $WG="$objWG"
	              Add-XAWorkerGroupServer $WG -ServerNames $server
	              $reswgs[$i]=$wg
                  $i++
	            }
	        }   
	    }
	}
	$message = [string]"Server/s " + "$resservers"+ " added to Worker groups " + "$reswgs" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x0)
}

$Remove_Srv_WG_OnClick = 
{
    $j=0
	$servers = $Servers_list.CheckedItems
	$wgs = $WG_list.CheckedItems
	$cservers = $servers.count -1
	$cwgs = $wgs.count -1
	$resservers = (0..$cservers)
	$reswgs = (0..$cwgs)
	foreach ( $objItem in $Servers_list.CheckedItems ) {
	   $i=0
	   $server="$objItem"
	   $resservers[$j]=$server
	   $j++
	   IF ($WG_list.CheckedItems -gt 0){
	       IF ($Servers_list.CheckedItems -gt 0){
	          foreach ( $objWG in $WG_list.CheckedItems ) {
                  $WG="$objWG"
	              Remove-XAWorkerGroupServer $WG -ServerNames $server
	              $reswgs[$i]=$wg
                  $i++
	            }
	        }   
	    }
	}
	$message = [string]"Server/s " + "$resservers"+ " removed to Worker groups " + "$reswgs" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x0)
}

$wg_members_OnClick =
{

    $n=0
    $wgs=Get-XAWorkerGroup|select WorkerGroupName, @{n="Servers";e= {[string]::join(";", $_.ServerNames)}}
    $numero=$wg_list.CheckedItems.count -1
    $perms = (0 .. $numero)
    foreach ($objItem in $wg_list.CheckedItems)
	{
	   $wg="$objItem"
	   $dates = $wgs|where {$_.WorkerGroupName -eq $wg}
	   $server = $dates.Servers|out-string
	   $perms[$n] = "Worker group members " + $wg + ": " + "`r`n" + $server + "`r`n" + "`r`n"
	   $n++
	}
	$app_Server.text = $perms
}

$Enable_app_OnClick =
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    $i=0
    foreach ($objItem in $Applications.CheckedItems)
	{
        $app="$objItem"
        $a = new-object -comobject wscript.shell
	    $Pregunta = $a.popup("Are you sure to enable $app application?", 0,"Confirmation",4)
	    If ($Pregunta -eq 6) {
	       Enable-XAApplication $app
	       $applicationchecked[$i]=$app
           $i++
	     }
	}
	   $i--
	   $applicationchecked=$applicationchecked[0..$i]
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"This applications has been enabled: " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
       $wshell.Popup($message,0,"Done",0x0)
}



$OnLoadForm_StateCorrection=
{#Correct the initial state of the form to prevent the .Net maximized form issue
	$form1.WindowState = $InitialFormWindowState
}

$disa_console_OnClick=
 {
 Hide-Console
 }

$ena_console_OnClick=
 {
 Show-Console
 }

$but_clear_field_OnClick=
{
$Dom_group.Text = $null
}
 
#----------------------------------------------
#region Generated Form Code
$form1.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 663
$System_Drawing_Size.Width = 851
$form1.ClientSize = $System_Drawing_Size
$form1.DataBindings.DefaultDataSourceUpdateMode = 0
$form1.Name = "form1"
$form1.Text = "Citrix tool"

$disa_console.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 211
$System_Drawing_Point.Y = 527
$disa_console.Location = $System_Drawing_Point
$disa_console.Name = "disa_console"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 117
$disa_console.Size = $System_Drawing_Size
$disa_console.TabIndex = 32
$disa_console.TabStop = $True
$disa_console.Text = "Disable Console"
$file="$scriptPath\apps.csv"
If((Test-Path -path $file)) {
$disa_console.Checked = $true
Hide-Console
}
$disa_console.UseVisualStyleBackColor = $True
$disa_console.add_Click($disa_console_OnClick)
$form1.Controls.Add($disa_console)

$ena_console.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 211
$System_Drawing_Point.Y = 505
$ena_console.Location = $System_Drawing_Point
$ena_console.Name = "ena_console"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 117
$ena_console.Size = $System_Drawing_Size
$ena_console.TabIndex = 31
$ena_console.TabStop = $True
$ena_console.Text = "Enable Console"
$ena_console.UseVisualStyleBackColor = $True
$ena_console.add_Click($ena_console_OnClick)
$form1.Controls.Add($ena_console)

$Enable_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 14
$System_Drawing_Point.Y = 578
$Enable_app.Location = $System_Drawing_Point
$Enable_app.Name = "Enable_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 56
$System_Drawing_Size.Width = 75
$Enable_app.Size = $System_Drawing_Size
$Enable_app.TabIndex = 30
$Enable_app.Text = "Enable application"
$Enable_app.UseVisualStyleBackColor = $True
$Enable_app.add_Click($Enable_app_OnClick)

$form1.Controls.Add($Enable_app)

$Refresh.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 181
$System_Drawing_Point.Y = 578
$Refresh.Location = $System_Drawing_Point
$Refresh.Name = "Refresh"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 56
$System_Drawing_Size.Width = 131
$Refresh.Size = $System_Drawing_Size
$Refresh.TabIndex = 8
$Refresh.Text = "Refresh (It takes)"
$Refresh.UseVisualStyleBackColor = $True
$Refresh.add_Click($Refresh_OnClick)

$form1.Controls.Add($Refresh)

$Permisos.Appearance = 1
$Permisos.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 352
$System_Drawing_Point.Y = 12
$Permisos.Location = $System_Drawing_Point
$Permisos.Name = "Permisos"
$Permisos.SelectedIndex = 0
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 642
$System_Drawing_Size.Width = 480
$Permisos.Size = $System_Drawing_Size
$Permisos.TabIndex = 19

$form1.Controls.Add($Permisos)
$Users_tab.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)
$Users_tab.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$Users_tab.Location = $System_Drawing_Point
$Users_tab.Name = "Users_tab"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$Users_tab.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 613
$System_Drawing_Size.Width = 472
$Users_tab.Size = $System_Drawing_Size
$Users_tab.TabIndex = 0
$Users_tab.Text = "Users"
$Users_tab.add_Click($handler_TabPage:_Click)

$Permisos.Controls.Add($Users_tab)

$but_clear_field.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 166
$System_Drawing_Point.Y = 520
$but_clear_field.Location = $System_Drawing_Point
$but_clear_field.Name = "but_clear_field"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$but_clear_field.Size = $System_Drawing_Size
$but_clear_field.TabIndex = 31
$but_clear_field.Text = "Clear Field"
$but_clear_field.UseVisualStyleBackColor = $True
$but_clear_field.add_Click($but_clear_field_OnClick)

$Users_tab.Controls.Add($but_clear_field)


$exp_perm_file.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$exp_perm_file.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 391
$System_Drawing_Point.Y = 543
$exp_perm_file.Location = $System_Drawing_Point
$exp_perm_file.Name = "exp_perm_file"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$exp_perm_file.Size = $System_Drawing_Size
$exp_perm_file.TabIndex = 19
$exp_perm_file.Text = "Export permissions to file"
$exp_perm_file.UseVisualStyleBackColor = $False
$exp_perm_file.add_Click($exp_perm_file_OnClick)

$Users_tab.Controls.Add($exp_perm_file)

$lab_app_users.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 17
$lab_app_users.Location = $System_Drawing_Point
$lab_app_users.Name = "label4"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 100
$lab_app_users.Size = $System_Drawing_Size
$lab_app_users.TabIndex = 18
$lab_app_users.Text = "Application / Users"

$Users_tab.Controls.Add($lab_app_users)

$Dom_group.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 494
$Dom_group.Location = $System_Drawing_Point
$Dom_group.Name = "Dom_group"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 446
$Dom_group.Size = $System_Drawing_Size
$Dom_group.TabIndex = 4

$Users_tab.Controls.Add($Dom_group)


$Groups_app.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 39
$Groups_app.Location = $System_Drawing_Point
$Groups_app.Multiline = $True
$Groups_app.Name = "Groups_app"
$Groups_app.ReadOnly = $True
$Groups_app.ScrollBars = 2
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 446
$Groups_app.Size = $System_Drawing_Size
$Groups_app.TabIndex = 1
$Groups_app.add_TextChanged($handler_textBox1_TextChanged)

$Users_tab.Controls.Add($Groups_app)

$Permissions_app.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Permissions_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 310
$System_Drawing_Point.Y = 543
$Permissions_app.Location = $System_Drawing_Point
$Permissions_app.Name = "Permissions_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$Permissions_app.Size = $System_Drawing_Size
$Permissions_app.TabIndex = 10
$Permissions_app.Text = "Permissions application report"
$Permissions_app.UseVisualStyleBackColor = $False
$Permissions_app.add_Click($permission_app_Click)

$Users_tab.Controls.Add($Permissions_app)

$Remove.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Remove.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 574
$Remove.Location = $System_Drawing_Point
$Remove.Name = "Remove"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Remove.Size = $System_Drawing_Size
$Remove.TabIndex = 7
$Remove.Text = "Remove"
$Remove.UseVisualStyleBackColor = $False
$Remove.add_Click($Remove_OnClick)

$Users_tab.Controls.Add($Remove)

$lab_usr_dom.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 473
$lab_usr_dom.Location = $System_Drawing_Point
$lab_usr_dom.Name = "label1"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 18
$System_Drawing_Size.Width = 500
$lab_usr_dom.Size = $System_Drawing_Size
$lab_usr_dom.TabIndex = 5
$lab_usr_dom.Text = "Domain groups or users (use with format Domain\login and ';' separator for multiple values)"

$Users_tab.Controls.Add($lab_usr_dom)

$Add.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Add.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 545
$Add.Location = $System_Drawing_Point
$Add.Name = "Add"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Add.Size = $System_Drawing_Size
$Add.TabIndex = 6
$Add.Text = "Add"
$Add.UseVisualStyleBackColor = $False
$Add.add_Click($Add_Click)

$Users_tab.Controls.Add($Add)


$servers_wg.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)
$servers_wg.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$servers_wg.Location = $System_Drawing_Point
$servers_wg.Name = "tabPage2"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$servers_wg.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 613
$System_Drawing_Size.Width = 472
$servers_wg.Size = $System_Drawing_Size
$servers_wg.TabIndex = 1

$farm=get-xafarm

IF ($farm.serverversion.major -ge 6) {
$servers_wg.Text = "Servers/Worker Groups"
}
else {
$servers_wg.Text = "Servers"
}
$Permisos.Controls.Add($servers_wg)

IF ($farm.serverversion.major -ge 6) {
$wg_members.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 150
$System_Drawing_Point.Y = 497
$wg_members.Location = $System_Drawing_Point
$wg_members.Name = "wg_members"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 140
$wg_members.Size = $System_Drawing_Size
$wg_members.TabIndex = 29
$wg_members.Text = "Worker groups servers"
$wg_members.UseVisualStyleBackColor = $True
$wg_members.add_Click($wg_members_OnClick)

$servers_wg.Controls.Add($wg_members)

$Remove_Srv_WG.DataBindings.DefaultDataSourceUpdateMode = 0
$Remove_Srv_WG.Font = New-Object System.Drawing.Font("Webdings",11,0,3,1)

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 150
$System_Drawing_Point.Y = 244
$Remove_Srv_WG.Location = $System_Drawing_Point
$Remove_Srv_WG.Name = "Remove_Srv_WG"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 57
$System_Drawing_Size.Width = 23
$Remove_Srv_WG.Size = $System_Drawing_Size
$Remove_Srv_WG.TabIndex = 28
$Remove_Srv_WG.Tag = ""
$Remove_Srv_WG.Text = "5"

$Remove_Srv_WG.UseVisualStyleBackColor = $True
$Remove_Srv_WG.add_Click($Remove_Srv_WG_OnClick)

$servers_wg.Controls.Add($Remove_Srv_WG)

$add_srv_WG.DataBindings.DefaultDataSourceUpdateMode = 0
$add_srv_WG.Font = New-Object System.Drawing.Font("Webdings",11,0,3,1)

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 179
$System_Drawing_Point.Y = 244
$add_srv_WG.Location = $System_Drawing_Point
$add_srv_WG.Name = "add_srv_WG"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 57
$System_Drawing_Size.Width = 23

$add_srv_WG.Size = $System_Drawing_Size
$add_srv_WG.TabIndex = 27
$add_srv_WG.Tag = ""
$add_srv_WG.Text = "6"
$add_srv_WG.UseVisualStyleBackColor = $True
$add_srv_WG.add_Click($add_srv_WG_OnClick)

$servers_wg.Controls.Add($add_srv_WG)

$chk_workgroup.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 85
$System_Drawing_Point.Y = 497
$chk_workgroup.Location = $System_Drawing_Point
$chk_workgroup.Name = "chk_workgroup"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 59
$chk_workgroup.Size = $System_Drawing_Size
$chk_workgroup.TabIndex = 24
$chk_workgroup.Text = "Check"
$chk_workgroup.UseVisualStyleBackColor = $False
$chk_workgroup.add_Click($chk_workgroup_OnClick)

$servers_wg.Controls.Add($chk_workgroup)

$unchk_workgroup.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 497
$unchk_workgroup.Location = $System_Drawing_Point
$unchk_workgroup.Name = "unchk_workgroup"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 59
$unchk_workgroup.Size = $System_Drawing_Size
$unchk_workgroup.TabIndex = 23
$unchk_workgroup.Text = "Uncheck"
$unchk_workgroup.UseVisualStyleBackColor = $False
$unchk_workgroup.add_Click($unchk_workgroup_OnClick)

$servers_wg.Controls.Add($unchk_workgroup)

$lab_workergroup.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 288
$lab_workergroup.Location = $System_Drawing_Point
$lab_workergroup.Name = "lab_workergroup"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 18
$System_Drawing_Size.Width = 100
$lab_workergroup.Size = $System_Drawing_Size
$lab_workergroup.TabIndex = 22
$lab_workergroup.Text = "Worker groups:"

$servers_wg.Controls.Add($lab_workergroup)

$WG_list.DataBindings.DefaultDataSourceUpdateMode = 0
$WG_list.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 307
$WG_list.Location = $System_Drawing_Point
$WG_list.Name = "WG_list"
$WG_list.ScrollAlwaysVisible = $True
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 184
$System_Drawing_Size.Width = 188
$WG_list.Size = $System_Drawing_Size
$WG_list.TabIndex = 21

$servers_wg.Controls.Add($WG_list)

}
$publishedinserver.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 225
$System_Drawing_Point.Y = 17
$publishedinserver.Location = $System_Drawing_Point
$publishedinserver.Name = "publishedinserver"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 300
$publishedinserver.Size = $System_Drawing_Size
$publishedinserver.TabIndex = 25
IF ($farm.serverversion.major -ge 6) {

$publishedinserver.Text = "Servers on Applications or WG:"
}
else {
$publishedinserver.Text = "Servers on Applications:"
}
$servers_wg.Controls.Add($publishedinserver)


$exp_app_srv.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$exp_app_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 391
$System_Drawing_Point.Y = 543
$exp_app_srv.Location = $System_Drawing_Point
$exp_app_srv.Name = "exp_app_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$exp_app_srv.Size = $System_Drawing_Size
$exp_app_srv.TabIndex = 20
$exp_app_srv.Text = "Export App/Srv to txt"
$exp_app_srv.UseVisualStyleBackColor = $False
$exp_app_srv.add_Click($exp_app_srv_OnClick)

$servers_wg.Controls.Add($exp_app_srv)

$Perm_server.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Perm_server.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 310
$System_Drawing_Point.Y = 543
$Perm_server.Location = $System_Drawing_Point
$Perm_server.Name = "Perm_server"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$Perm_server.Size = $System_Drawing_Size
$Perm_server.TabIndex = 19
$Perm_server.Text = "Application/Server Report"
$Perm_server.UseVisualStyleBackColor = $False
$Perm_server.add_Click($Perm_server_OnClick)

$servers_wg.Controls.Add($Perm_server)

$App_server.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 225
$System_Drawing_Point.Y = 39
$App_server.Location = $System_Drawing_Point
$App_server.Multiline = $True
$App_server.Name = "App_server"
$App_server.ReadOnly = $True
$App_server.ScrollBars = 2
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 455
$System_Drawing_Size.Width = 241
$App_server.Size = $System_Drawing_Size
$App_server.TabIndex = 18

$servers_wg.Controls.Add($App_server)

$Servers_list.DataBindings.DefaultDataSourceUpdateMode = 0
$Servers_list.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 39
$Servers_list.Location = $System_Drawing_Point
$Servers_list.Name = "Servers_list"
$Servers_list.ScrollAlwaysVisible = $True
$System_Drawing_Size = New-Object System.Drawing.Size
IF ($farm.serverversion.major -ge 6) {
$System_Drawing_Size.Height = 199
}
else{
$System_Drawing_Size.Height = 465
}
$System_Drawing_Size.Width = 188
$Servers_list.Size = $System_Drawing_Size
$Servers_list.TabIndex = 12

$servers_wg.Controls.Add($Servers_list)

$Check_srv.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Check_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
IF ($farm.serverversion.major -ge 6) {
$System_Drawing_Point.X = 85
$System_Drawing_Point.Y = 244
}
else{
$System_Drawing_Point.X = 85
$System_Drawing_Point.Y = 497
}
$Check_srv.Location = $System_Drawing_Point
$Check_srv.Name = "Check_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 59
$Check_srv.Size = $System_Drawing_Size
$Check_srv.TabIndex = 14
$Check_srv.Text = "Check"
$Check_srv.UseVisualStyleBackColor = $False
$Check_srv.add_Click($Check_srv_OnClick)

$servers_wg.Controls.Add($Check_srv)

$lab_srvs.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 17
$lab_srvs.Location = $System_Drawing_Point
$lab_srvs.Name = "label3"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 100
$lab_srvs.Size = $System_Drawing_Size
$lab_srvs.TabIndex = 17
$lab_srvs.Text = "Servers:"

$servers_wg.Controls.Add($lab_srvs)

$Uncheck_srv.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Uncheck_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
IF ($farm.serverversion.major -ge 6) {
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 244
}
else{
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 497
}
$Uncheck_srv.Location = $System_Drawing_Point
$Uncheck_srv.Name = "Uncheck_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 59
$Uncheck_srv.Size = $System_Drawing_Size
$Uncheck_srv.TabIndex = 13
$Uncheck_srv.Text = "Uncheck"
$Uncheck_srv.UseVisualStyleBackColor = $False
$Uncheck_srv.add_Click($Uncheck_srv_OnClick)

$servers_wg.Controls.Add($Uncheck_srv)

$Publish.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Publish.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 545
$Publish.Location = $System_Drawing_Point
$Publish.Name = "Publish"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Publish.Size = $System_Drawing_Size
$Publish.TabIndex = 15
$Publish.Text = "Publish"
$Publish.UseVisualStyleBackColor = $False
$Publish.add_Click($Publish_OnClick)

$servers_wg.Controls.Add($Publish)

$Unpublish.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)

$Unpublish.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 574
$Unpublish.Location = $System_Drawing_Point
$Unpublish.Name = "Unpublish"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Unpublish.Size = $System_Drawing_Size
$Unpublish.TabIndex = 16
$Unpublish.Text = "Unpublish"
$Unpublish.UseVisualStyleBackColor = $False
$Unpublish.add_Click($Unpublish_OnClick)

$servers_wg.Controls.Add($Unpublish)


$PublishNew.BackColor = [System.Drawing.Color]::FromArgb(255,212,208,200)
$PublishNew.DataBindings.DefaultDataSourceUpdateMode = 0
$PublishNew.ForeColor = [System.Drawing.Color]::FromArgb(255,0,0,0)
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$PublishNew.Location = $System_Drawing_Point
$PublishNew.Name = "PublishNew"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$PublishNew.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 613
$System_Drawing_Size.Width = 472
$PublishNew.Size = $System_Drawing_Size
$PublishNew.TabIndex = 2
$PublishNew.Text = "Publish_New"

$Permisos.Controls.Add($PublishNew)

$Streamed_App.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 83
$System_Drawing_Point.Y = 111
$Streamed_App.Location = $System_Drawing_Point
$Streamed_App.Name = "Streamed_App"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 150
$Streamed_App.Size = $System_Drawing_Size
$Streamed_App.TabIndex = 27
$Streamed_App.TabStop = $True
$Streamed_App.Text = "Streamed to Server"
$Streamed_App.UseVisualStyleBackColor = $True
$Streamed_App.add_Click($Streamed_App_OnClick)

$PublishNew.Controls.Add($Streamed_App)


$Local_App.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 111
$Local_App.Location = $System_Drawing_Point
$Local_App.Name = "Local_App"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 24
$System_Drawing_Size.Width = 57
$Local_App.Size = $System_Drawing_Size
$Local_App.TabIndex = 26
$Local_App.TabStop = $True
$Local_App.Text = "Local"
$Local_App.Checked = $true
$Local_App.UseVisualStyleBackColor = $True
$Local_App.add_Click($Local_App_OnClick)
$PublishNew.Controls.Add($Local_App)

$Dir_App.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 201
$Dir_App.Location = $System_Drawing_Point
$Dir_App.Name = "Dir_App"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 436
$Dir_App.Size = $System_Drawing_Size
$Dir_App.TabIndex = 3
$Dir_App.add_TextChanged($handler_textBox4_TextChanged)

$PublishNew.Controls.Add($Dir_App)


$Publish_New_App.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 295
$Publish_New_App.Location = $System_Drawing_Point
$Publish_New_App.Name = "Publish_App"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 75
$Publish_New_App.Size = $System_Drawing_Size
$Publish_New_App.TabIndex = 25
$Publish_New_App.Text = "Publish"
$Publish_New_App.UseVisualStyleBackColor = $True
$Publish_New_App.add_Click($Publish_New_App_OnClick)

$PublishNew.Controls.Add($Publish_New_App)

$WorkingDir.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 183
$WorkingDir.Location = $System_Drawing_Point
$WorkingDir.Name = "WorkingDir"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 15
$System_Drawing_Size.Width = 600
$WorkingDir.Size = $System_Drawing_Size
$WorkingDir.TabIndex = 4
$WorkingDir.Text = "Working directory:"

$PublishNew.Controls.Add($WorkingDir)

$pkg_cmd.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 159
$pkg_cmd.Location = $System_Drawing_Point
$pkg_cmd.Name = "pkg_cmd"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 436
$pkg_cmd.Size = $System_Drawing_Size
$pkg_cmd.TabIndex = 2

$PublishNew.Controls.Add($pkg_cmd)

$Command_Line_Lab.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 142
$Command_Line_Lab.Location = $System_Drawing_Point
$Command_Line_Lab.Name = "Command_Line_Lab"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 14
$System_Drawing_Size.Width = 300
$Command_Line_Lab.Size = $System_Drawing_Size
$Command_Line_Lab.TabIndex = 30
$Command_Line_Lab.Text = "Command line:"

$PublishNew.Controls.Add($Command_Line_Lab)

$Cli_App_Folder.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 260
$Cli_App_Folder.Location = $System_Drawing_Point
$Cli_App_Folder.Name = "Cli_App_Folder"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 436
$Cli_App_Folder.Size = $System_Drawing_Size
$Cli_App_Folder.TabIndex = 7

$PublishNew.Controls.Add($Cli_App_Folder)

$Cli_app_folder_lab.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 240
$Cli_app_folder_lab.Location = $System_Drawing_Point
$Cli_app_folder_lab.Name = "Cli_app_folder_lab"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 17
$System_Drawing_Size.Width = 127
$Cli_app_folder_lab.Size = $System_Drawing_Size
$Cli_app_folder_lab.TabIndex = 22
$Cli_app_folder_lab.Text = "Client application folder:"
$Cli_app_folder_lab.add_Click($handler_Cli_app_folder_Click)

$PublishNew.Controls.Add($Cli_app_folder_lab)

$App_Description.BackColor = [System.Drawing.Color]::FromArgb(255,255,255,255)
$App_Description.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 76
$App_Description.Location = $System_Drawing_Point
$App_Description.Name = "App_Description"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 436
$App_Description.Size = $System_Drawing_Size
$App_Description.TabIndex = 1

$PublishNew.Controls.Add($App_Description)

$AppDescription_lab.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 58
$AppDescription_lab.Location = $System_Drawing_Point
$AppDescription_lab.Name = "AppDescription"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 15
$System_Drawing_Size.Width = 128
$AppDescription_lab.Size = $System_Drawing_Size
$AppDescription_lab.TabIndex = 2
$AppDescription_lab.Text = "Application Description:"
$AppDescription_lab.add_Click($handler_label6_Click)

$PublishNew.Controls.Add($AppDescription_lab)

$DisplayName_lab.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 17
$DisplayName_lab.Location = $System_Drawing_Point
$DisplayName_lab.Name = "DisplayName_lab"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 15
$System_Drawing_Size.Width = 141
$DisplayName_lab.Size = $System_Drawing_Size
$DisplayName_lab.TabIndex = 1
$DisplayName_lab.Text = "Display name:"

$PublishNew.Controls.Add($DisplayName_lab)

$DisplayName.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 35
$DisplayName.Location = $System_Drawing_Point
$DisplayName.Name = "DisplayName"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 435
$DisplayName.Size = $System_Drawing_Size
$DisplayName.TabIndex = 0

$PublishNew.Controls.Add($DisplayName)

$Searchtab.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$Searchtab.Location = $System_Drawing_Point
$Searchtab.Name = "Searchtab"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$Searchtab.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 613
$System_Drawing_Size.Width = 472
$Searchtab.Size = $System_Drawing_Size
$Searchtab.TabIndex = 3
$Searchtab.Text = "Search"
$Searchtab.UseVisualStyleBackColor = $True

$Permisos.Controls.Add($Searchtab)
$app_list_search.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 160
$app_list_search.Location = $System_Drawing_Point
$app_list_search.Multiline = $True
$app_list_search.Name = "app_list_search"
$app_list_search.ReadOnly = $True
$app_list_search.ScrollBars = 2
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 388
$System_Drawing_Size.Width = 365
$app_list_search.Size = $System_Drawing_Size
$app_list_search.TabIndex = 7

$Searchtab.Controls.Add($app_list_search)

$lab_app_list.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 140
$lab_app_list.Location = $System_Drawing_Point
$lab_app_list.Name = "tab_app_list"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 17
$System_Drawing_Size.Width = 100
$lab_app_list.Size = $System_Drawing_Size
$lab_app_list.TabIndex = 6
$lab_app_list.Text = "Application list:"

$Searchtab.Controls.Add($lab_app_list)


$chk_search.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 566
$chk_search.Location = $System_Drawing_Point
$chk_search.Name = "chk_search"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 94
$chk_search.Size = $System_Drawing_Size
$chk_search.TabIndex = 5
$chk_search.Text = "Check Apps"
$chk_search.UseVisualStyleBackColor = $True
$chk_search.add_Click($chk_search_OnClick)

$Searchtab.Controls.Add($chk_search)


$but_Search.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 310
$System_Drawing_Point.Y = 94
$but_Search.Location = $System_Drawing_Point
$but_Search.Name = "but_Search"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 75
$but_Search.Size = $System_Drawing_Size
$but_Search.TabIndex = 4
$but_Search.Text = "Search"
$but_Search.UseVisualStyleBackColor = $True
$but_Search.add_Click($but_Search_OnClick)

$Searchtab.Controls.Add($but_Search)

$txt_search.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 35
$txt_search.Location = $System_Drawing_Point
$txt_search.Name = "txt_search"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 365
$txt_search.Size = $System_Drawing_Size
$txt_search.TabIndex = 3

$Searchtab.Controls.Add($txt_search)

$lab_srch_field.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 17
$lab_srch_field.Location = $System_Drawing_Point
$lab_srch_field.Name = "lab_srch_field"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 17
$System_Drawing_Size.Width = 100
$lab_srch_field.Size = $System_Drawing_Size
$lab_srch_field.TabIndex = 2
$lab_srch_field.Text = "Search field:"
$lab_srch_field.UseCompatibleTextRendering = $True

$Searchtab.Controls.Add($lab_srch_field)

$Comb_search_by.DataBindings.DefaultDataSourceUpdateMode = 0
$Comb_search_by.FormattingEnabled = $True
$Comb_search_by.Items.Add("Server")|Out-Null
IF ($farm.serverversion.major -ge 6) {
$Comb_search_by.Items.Add("Worker Group")|Out-Null
}
$Comb_search_by.Items.Add("User or group")|Out-Null
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 96
$Comb_search_by.Location = $System_Drawing_Point
$Comb_search_by.Name = "Comb_search_by"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 21
$System_Drawing_Size.Width = 284
$Comb_search_by.Size = $System_Drawing_Size
$Comb_search_by.TabIndex = 1

$Searchtab.Controls.Add($Comb_search_by)

$lab_search_by.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 74
$lab_search_by.Location = $System_Drawing_Point
$lab_search_by.Name = "lab_search_by"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 90
$lab_search_by.Size = $System_Drawing_Size
$lab_search_by.TabIndex = 0
$lab_search_by.Text = "Search by:"

$Searchtab.Controls.Add($lab_search_by)

$label2.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 54
$label2.Location = $System_Drawing_Point
$label2.Name = "label2"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 160
$label2.Size = $System_Drawing_Size
$label2.TabIndex = 11
$label2.Text = "Citrix Farm Applications:"
$label2.add_Click($handler_label2_Click)

$form1.Controls.Add($label2)


$Uncheck_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 505
$Uncheck_app.Location = $System_Drawing_Point
$Uncheck_app.Name = "Unchech_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Uncheck_app.Size = $System_Drawing_Size
$Uncheck_app.TabIndex = 2
$Uncheck_app.Text = "Uncheck"
$Uncheck_app.UseVisualStyleBackColor = $True
$Uncheck_app.add_Click($uncheck_app_Click)

$form1.Controls.Add($Uncheck_app)

$Applications.DataBindings.DefaultDataSourceUpdateMode = 0
$Applications.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 12
$System_Drawing_Point.Y = 76
$Applications.Location = $System_Drawing_Point
$Applications.Name = "Applications"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 300
$Applications.Size = $System_Drawing_Size
$Applications.TabIndex = 0
$Applications.add_SelectedIndexChanged($handler_checkedListBox1_SelectedIndexChanged)

    $n=0
    foreach($test in $apps)
    {
    $app=$apps[$n].ApplicationName
    [void] $Applications.Items.Add("$app")
    $n=$n+1
    }

$form1.Controls.Add($Applications)


$Check_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 95
$System_Drawing_Point.Y = 505
$Check_app.Location = $System_Drawing_Point
$Check_app.Name = "Check_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Check_app.Size = $System_Drawing_Size
$Check_app.TabIndex = 3
$Check_app.Text = "Check"
$Check_app.UseVisualStyleBackColor = $True
$Check_app.add_Click($Check_app_OnClick)

$form1.Controls.Add($Check_app)

#endregion Generated Form Code

#Save the initial state of the form
$InitialFormWindowState = $form1.WindowState
#Init the OnLoad event to correct the initial state of the form
$form1.add_Load($OnLoadForm_StateCorrection)
#Show the Form
$form1.ShowDialog()| Out-Null

} #End Function

#Call the Function

GenerateForm
