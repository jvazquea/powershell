#Generated Form Function
$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
asnp Citrix.*

$x = @()
function GenerateForm {
########################################################################
# Code Generated By: SAPIEN Technologies PrimalForms (Community Edition) v1.0.10.0
# Generated On: 24/07/2015 14:25
# Generated By: Javier Vázquez Martín
########################################################################

#region Import the Assemblies
[reflection.assembly]::loadwithpartialname("System.Drawing") | Out-Null
[reflection.assembly]::loadwithpartialname("System.Windows.Forms") | Out-Null
#endregion

#region Generated Form Objects
$form1 = New-Object System.Windows.Forms.Form
$Permisos = New-Object System.Windows.Forms.TabControl
$tabPage1 = New-Object System.Windows.Forms.TabPage
$tabPage2 = New-Object System.Windows.Forms.TabPage

#labels
$label1 = New-Object System.Windows.Forms.Label
$label2 = New-Object System.Windows.Forms.Label
$label3 = New-Object System.Windows.Forms.Label
$label4 = New-Object System.Windows.Forms.Label
$server_right = New-Object System.Windows.Forms.Label

#textbox
$Dom_group = New-Object System.Windows.Forms.TextBox
$Groups_app = New-Object System.Windows.Forms.TextBox
$App_server = New-Object System.Windows.Forms.TextBox

#buttons
$Add = New-Object System.Windows.Forms.Button
$exp_app_srv = New-Object System.Windows.Forms.Button
$Perm_server = New-Object System.Windows.Forms.Button
$Export_txt = New-Object System.Windows.Forms.Button
$Permissions_app = New-Object System.Windows.Forms.Button
$Refresh = New-Object System.Windows.Forms.Button
$Remove = New-Object System.Windows.Forms.Button
$Uncheck_srv = New-Object System.Windows.Forms.Button
$Publish = New-Object System.Windows.Forms.Button
$Unpublish = New-Object System.Windows.Forms.Button
$Check_srv = New-Object System.Windows.Forms.Button
$Uncheck_app = New-Object System.Windows.Forms.Button
$Check_app = New-Object System.Windows.Forms.Button

#checkedlistboxes
$Servers_list = New-Object System.Windows.Forms.CheckedListBox
$Applications = New-Object System.Windows.Forms.CheckedListBox

$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState
#endregion Generated Form Objects

#Import CSV with applications and permissions

If((Test-Path -path $scriptPath\apps.csv)) {
$apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
}
else {

$nombrefile="apps.csv"
$file = [string]"$scriptPath\$nombrefile"
$filetemp = [string]"$scriptPath\app-listtemp.csv"
$datos=Get-XAApplicationReport * | select @{n="ApplicationName";e={[string]::join(";", $_.Browsername)}}, @{n="UsersandGroups";e={[string]::join(";", $_.Accounts)}}, @{n="Servers";e={[string]::join(";", $_.ServerNames)}}

for ($i=0;$i -lt $datos.length;$i++) {

   if ($datos[$i].servers -gt 0) {
      $text=$datos[$i].servers.split("{;}")
      $text=$text|sort-object
      $cuenta=$text.count
      $prueba=$text -join " ; "
      $datos[$i].servers=$prueba
      $datos[$i].servers
   }
}

$datos|Export-Csv $file
get-content $file |select -Skip 1 |set-content "$filetemp"
move "$filetemp" $file -Force
$apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 

}

$servers=get-xaserver|sort-object Servername

    $n=0
    foreach($test in $servers)
    {
    $server=$servers[$n].Servername
    [void] $Servers_list.Items.Add("$server")
    $n=$n+1
    }


#----------------------------------------------
#Generated Event Script Blocks
#----------------------------------------------
#Provide Custom Code for events specified in PrimalForms.
$Export_txt_OnClick= 
{
#TODO: Place custom script here

}
$Export_txt_OnClick= 
{
        if ($Groups_app.Text -ne $empty) {
	set-content -path $scriptpath\app-groups.txt -value $Groups_app.Text
        }
    
}

$Unpublish_OnClick= 
{
	$apps=$Applications.CheckedItems
	$capps=$apps.count -1
	$servers=$Servers_list.CheckedItems
	$cservers=$servers.count -1
	$resapps=(0..$capps)
	$resservers=(0..$cservers)
	$j=0
	$a = new-object -comobject wscript.shell
	$Pregunta = $a.popup("Are you sure to remove permission in $app to the Servers Selected?", 0,"Delete Permission",4)
	If ($Pregunta -eq 6) {
		foreach ( $objItem in $Applications.CheckedItems ) {
		$i=0
		$app="$objItem"
		$resapps[$j]=$app
		$j++
		foreach ( $objServer in $Servers_list.CheckedItems ) {
             		$server="$objServer"
	     		Remove-XAApplicationServer -BrowserName $app -ServerNames $server
	    		$resservers[$i]=$server
             		$i++
	   	}
		}
	}
	$resservers=$resservers|out-string
	$resapps=$resapps|out-string
	$message = [string]"Server/s " + "$resservers"+ " removed to Application/s " + "$resapps" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
        $wshell.Popup($message,0,"Done",0x0)
}

$handler_checkedListBox1_SelectedIndexChanged= 
{
#TODO: Place custom script here

}

$Uncheck_srv_OnClick= 
{
        for ($i=0;$i -lt $Servers_list.Items.count;$i++) {
            $Servers_list.SetItemchecked($i,$False)
        }
    
}

$uncheck_app_Click= 
{
        for ($i=0;$i -lt $Applications.Items.count;$i++) {
            $Applications.SetItemchecked($i,$False)
        }
    
}

$permission_app_Click= 
{

    $n=0
    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
    $numero=$Applications.CheckedItems.count -1
    $permiso = (0 .. $numero)
    foreach ($objItem in $Applications.CheckedItems)
	{
	$app="$objItem"
	$groups = $apps|where {$_.ApplicationName -eq $app}|select UsersandGroups
	$grupo = $groups.UsersandGroups
	$permiso[$n] = "Application permissions " + $app + ": " + "`r`n" + $grupo + "`r`n" + "`r`n"
	$n = $n + 1
	}

    $Groups_app.Text = $permiso
    
}

$Add_Click= 
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    IF ($Dom_group.Text -lt 0) {
	$message = "Empty field" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
   	$wshell.Popup($message,0,"Write a group name",0x0)
	} else {
              $i=0
	      foreach ( $objItem in $Applications.CheckedItems ) {
	      $app="$objItem"
	      $groups = $Dom_group.Text
	      Add-XAApplicationAccount $app -accounts $groups -force
	      $applicationchecked[$i]=$app
              $i++
	      }
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"User/group addded " + $groups + " to applications " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x0)
    }
  
}

$Check_srv_OnClick= 
{
        for ($i=0;$i -lt $Servers_list.Items.count;$i++) {
            $Servers_list.SetItemchecked($i,$True)
        }
    
}

$Refresh_OnClick= 
{

$nombrefile="apps.csv"
$file = [string]"$scriptPath\$nombrefile"
$filetemp = [string]"$scriptPath\app-listtemp.csv"
$datos=Get-XAApplicationReport * | select @{n="ApplicationName";e={[string]::join(";", $_.Browsername)}}, @{n="UsersandGroups";e={[string]::join(";", $_.Accounts)}}, @{n="Servers";e={[string]::join(";", $_.ServerNames)}}

for ($i=0;$i -lt $datos.length;$i++) {

   if ($datos[$i].servers -gt 0) {
      $text=$datos[$i].servers.split("{;}")
      $text=$text|sort-object
      $cuenta=$text.count
      $prueba=$text -join " ; "
      $datos[$i].servers=$prueba
      $datos[$i].servers
   }
}

$datos|Export-Csv $file
get-content $file |select -Skip 1 |set-content "$filetemp"
move "$filetemp" $file -Force
$apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 

    $message = "Farm Data has been updated"
    $wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x0)
    
    $Applications.Items.clear()

    $n=0
    foreach($test in $apps)
    {
    $app=$apps[$n].ApplicationName
    [void] $Applications.Items.Add("$app")
    $n=$n+1
    }

    $Servers_list.Items.clear()
    
    $servers=get-xaserver|sort-object Servername

    $n=0
    foreach($test in $servers)
    {
    $server=$servers[$n].Servername
    [void] $Servers_list.Items.Add("$server")
    $n=$n+1
    }

}

$Publish_OnClick= 
{

	$apps=$Applications.CheckedItems
	$capps=$apps.count -1
	$servers=$Servers_list.CheckedItems
	$cservers=$servers.count -1
	$resapps=(0..$capps)
	$resservers=(0..$cservers)
	$j=0
	foreach ( $objItem in $Applications.CheckedItems ) {
	$i=0
	$app="$objItem"
	$resapps[$j]=$app
	$j++
	foreach ( $objServer in $Servers_list.CheckedItems ) {
               $server="$objServer"
	       Add-XAApplicationServer -BrowserName $app -ServerNames $server
	       $resservers[$i]=$server
               $i++
	   }
	}
	$resservers=$resservers|out-string
	$resapps=$resapps|out-string
	$message = [string]"Server/s " + "$resservers"+ " added to Application/s " + "$resapps" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
        $wshell.Popup($message,0,"Done",0x0)
}

$Check_app_OnClick= 
{

        for ($i=0;$i -lt $Applications.Items.count;$i++) {
            $Applications.SetItemchecked($i,$True)
        }
    
}

$Remove_OnClick= 
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    IF ($Dom_group.Text -lt 0) {
	$message = "Empty field" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
   	$wshell.Popup($message,0,"Write a group name",0x0)
	} else {
        $i=0
        foreach ($objItem in $Applications.CheckedItems)
	    {
             $app="$objItem"
             $groups = $Dom_group.Text
	     $a = new-object -comobject wscript.shell
	     $Pregunta = $a.popup("Are you sure to remove permission in $app to the user/group?", 0,"Delete Files",4)
	     If ($Pregunta -eq 6) {
	      Remove-XAApplicationAccount $app -accounts $groups
	      $applicationchecked[$i]=$app
              $i++
	     }
	}
	   if ($i -eq 0){
	      $message = [string]"Cancelado"
	      $wshell = New-Object -ComObject Wscript.Shell
              $wshell.Popup($message,0,"Done",0x0)
           } else {
           $i--
	   $applicationchecked=$applicationchecked[0..$i]
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"User/group removed " + $groups + " to applications " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x0)
}
}
}
$Perm_server_OnClick=
{

    $n=0
    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
    $numero=$Applications.CheckedItems.count -1
    $right = (0 .. $numero)
    foreach ($objItem in $Applications.CheckedItems)
	{
	$app="$objItem"
	$servers = $apps|where {$_.ApplicationName -eq $app}|select Servers|sort-object Servers
	$server = $servers.servers
	$right[$n] = "Application " + $app + " published in: " + "`r`n" + $server + "`r`n" + "`r`n"
	$n = $n + 1
	}

    $App_server.text = $right
    
}

$exp_app_srv_OnClick=
{
        if ($App_server.text -ne $empty) {
	set-content -path $scriptpath\app-servers.txt -value $App_server.text
        }
}

$OnLoadForm_StateCorrection=
{#Correct the initial state of the form to prevent the .Net maximized form issue
	$form1.WindowState = $InitialFormWindowState
}

#----------------------------------------------
#region Generated Form Code
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 662
$System_Drawing_Size.Width = 844
$form1.ClientSize = $System_Drawing_Size
$form1.DataBindings.DefaultDataSourceUpdateMode = 0
$form1.Name = "form1"
$form1.Text = "Citrix tool"


$Refresh.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 150
$System_Drawing_Point.Y = 584
$Refresh.Location = $System_Drawing_Point
$Refresh.Name = "Refresh"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 56
$System_Drawing_Size.Width = 162
$Refresh.Size = $System_Drawing_Size
$Refresh.TabIndex = 8
$Refresh.Text = "Refresh (It takes)"
$Refresh.UseVisualStyleBackColor = $True
$Refresh.add_Click($Refresh_OnClick)

$form1.Controls.Add($Refresh)

$Permisos.Appearance = 1
$Permisos.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 352
$System_Drawing_Point.Y = 12
$Permisos.Location = $System_Drawing_Point
$Permisos.Name = "Permisos"
$Permisos.SelectedIndex = 0
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 638
$System_Drawing_Size.Width = 480
$Permisos.Size = $System_Drawing_Size
$Permisos.TabIndex = 19

$form1.Controls.Add($Permisos)
$tabPage1.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$tabPage1.Location = $System_Drawing_Point
$tabPage1.Name = "tabPage1"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$tabPage1.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 609
$System_Drawing_Size.Width = 472
$tabPage1.Size = $System_Drawing_Size
$tabPage1.TabIndex = 0
$tabPage1.Text = "Users"
$tabPage1.UseVisualStyleBackColor = $True
$tabPage1.add_Click($handler_TabPage:_Click)

$Permisos.Controls.Add($tabPage1)

$Export_txt.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 359
$System_Drawing_Point.Y = 549
$Export_txt.Location = $System_Drawing_Point
$Export_txt.Name = "button1"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$Export_txt.Size = $System_Drawing_Size
$Export_txt.TabIndex = 19
$Export_txt.Text = "Export permissions to file"
$Export_txt.UseVisualStyleBackColor = $True
$Export_txt.add_Click($Export_txt_OnClick)

$tabPage1.Controls.Add($Export_txt)

$label4.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 30
$label4.Location = $System_Drawing_Point
$label4.Name = "label4"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 100
$label4.Size = $System_Drawing_Size
$label4.TabIndex = 18
$label4.Text = "Application / Users"

$tabPage1.Controls.Add($label4)

$Dom_group.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 494
$Dom_group.Location = $System_Drawing_Point
$Dom_group.Name = "Dom_group"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 446
$Dom_group.Size = $System_Drawing_Size
$Dom_group.TabIndex = 4

$tabPage1.Controls.Add($Dom_group)

$Groups_app.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 53
$Groups_app.Location = $System_Drawing_Point
$Groups_app.Multiline = $True
$Groups_app.Name = "Groups_app"
$Groups_app.ReadOnly = $True
$Groups_app.ScrollBars = 2
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 446
$Groups_app.Size = $System_Drawing_Size
$Groups_app.TabIndex = 1
$Groups_app.add_TextChanged($handler_textBox1_TextChanged)

$tabPage1.Controls.Add($Groups_app)


$Permissions_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 245
$System_Drawing_Point.Y = 549
$Permissions_app.Location = $System_Drawing_Point
$Permissions_app.Name = "Permissions_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$Permissions_app.Size = $System_Drawing_Size
$Permissions_app.TabIndex = 10
$Permissions_app.Text = "Permissions application report"
$Permissions_app.UseVisualStyleBackColor = $True
$Permissions_app.add_Click($permission_app_Click)

$tabPage1.Controls.Add($Permissions_app)


$Remove.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 580
$Remove.Location = $System_Drawing_Point
$Remove.Name = "Remove"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Remove.Size = $System_Drawing_Size
$Remove.TabIndex = 7
$Remove.Text = "Remove"
$Remove.UseVisualStyleBackColor = $True
$Remove.add_Click($Remove_OnClick)

$tabPage1.Controls.Add($Remove)

$label1.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 473
$label1.Location = $System_Drawing_Point
$label1.Name = "label1"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 18
$System_Drawing_Size.Width = 300
$label1.Size = $System_Drawing_Size
$label1.TabIndex = 5
$label1.Text = "Domain group or user (use with format Domain\login)"

$tabPage1.Controls.Add($label1)


$Add.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 549
$Add.Location = $System_Drawing_Point
$Add.Name = "Add"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Add.Size = $System_Drawing_Size
$Add.TabIndex = 6
$Add.Text = "Add"
$Add.UseVisualStyleBackColor = $True
$Add.add_Click($Add_Click)

$tabPage1.Controls.Add($Add)


$tabPage2.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$tabPage2.Location = $System_Drawing_Point
$tabPage2.Name = "tabPage2"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$tabPage2.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 609
$System_Drawing_Size.Width = 472
$tabPage2.Size = $System_Drawing_Size
$tabPage2.TabIndex = 1
$tabPage2.Text = "Servers"
$tabPage2.UseVisualStyleBackColor = $True

$Permisos.Controls.Add($tabPage2)

$exp_app_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 359
$System_Drawing_Point.Y = 549
$exp_app_srv.Location = $System_Drawing_Point
$exp_app_srv.Name = "exp_app_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$exp_app_srv.Size = $System_Drawing_Size
$exp_app_srv.TabIndex = 20
$exp_app_srv.Text = "Export App/Srv to file"
$exp_app_srv.UseVisualStyleBackColor = $True
$exp_app_srv.add_Click($exp_app_srv_OnClick)

$tabPage2.Controls.Add($exp_app_srv)


$Perm_server.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 245
$System_Drawing_Point.Y = 549
$Perm_server.Location = $System_Drawing_Point
$Perm_server.Name = "Perm_server"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 54
$System_Drawing_Size.Width = 75
$Perm_server.Size = $System_Drawing_Size
$Perm_server.TabIndex = 19
$Perm_server.Text = "Application/Server Report"
$Perm_server.UseVisualStyleBackColor = $True
$Perm_server.add_Click($Perm_server_OnClick)

$tabPage2.Controls.Add($Perm_server)

$App_server.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 214
$System_Drawing_Point.Y = 53
$App_server.Location = $System_Drawing_Point
$App_server.Multiline = $True
$App_server.Name = "App_server"
$App_server.ReadOnly = $True
$App_server.ScrollBars = 2
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 252
$App_server.Size = $System_Drawing_Size
$App_server.TabIndex = 18

$tabPage2.Controls.Add($App_server)

$Servers_list.DataBindings.DefaultDataSourceUpdateMode = 0
$Servers_list.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 53
$Servers_list.Location = $System_Drawing_Point
$Servers_list.Name = "Servers_list"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 188
$Servers_list.Size = $System_Drawing_Size
$Servers_list.TabIndex = 12

$tabPage2.Controls.Add($Servers_list)


$Check_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 110
$System_Drawing_Point.Y = 471
$Check_srv.Location = $System_Drawing_Point
$Check_srv.Name = "Check_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 67
$Check_srv.Size = $System_Drawing_Size
$Check_srv.TabIndex = 14
$Check_srv.Text = "Check"
$Check_srv.UseVisualStyleBackColor = $True
$Check_srv.add_Click($Check_srv_OnClick)

$tabPage2.Controls.Add($Check_srv)

$label3.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 31
$label3.Location = $System_Drawing_Point
$label3.Name = "label3"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 100
$label3.Size = $System_Drawing_Size
$label3.TabIndex = 17
$label3.Text = "Servers:"

$tabPage2.Controls.Add($label3)

$server_right.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 214
$System_Drawing_Point.Y = 31
$server_right.Location = $System_Drawing_Point
$server_right.Name = "server_right"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 250
$server_right.Size = $System_Drawing_Size
$server_right.TabIndex = 17
$server_right.Text = "Server/app Permissions:"

$tabPage2.Controls.Add($server_right)


$Uncheck_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 471
$Uncheck_srv.Location = $System_Drawing_Point
$Uncheck_srv.Name = "Uncheck_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 67
$Uncheck_srv.Size = $System_Drawing_Size
$Uncheck_srv.TabIndex = 13
$Uncheck_srv.Text = "Uncheck"
$Uncheck_srv.UseVisualStyleBackColor = $True
$Uncheck_srv.add_Click($Uncheck_srv_OnClick)

$tabPage2.Controls.Add($Uncheck_srv)


$Publish.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 549
$Publish.Location = $System_Drawing_Point
$Publish.Name = "Publish"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Publish.Size = $System_Drawing_Size
$Publish.TabIndex = 15
$Publish.Text = "Publish"
$Publish.UseVisualStyleBackColor = $True
$Publish.add_Click($Publish_OnClick)

$tabPage2.Controls.Add($Publish)


$Unpublish.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 580
$Unpublish.Location = $System_Drawing_Point
$Unpublish.Name = "Unpublish"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Unpublish.Size = $System_Drawing_Size
$Unpublish.TabIndex = 16
$Unpublish.Text = "Unpublish"
$Unpublish.UseVisualStyleBackColor = $True
$Unpublish.add_Click($Unpublish_OnClick)

$tabPage2.Controls.Add($Unpublish)



$label2.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 54
$label2.Location = $System_Drawing_Point
$label2.Name = "label2"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 160
$label2.Size = $System_Drawing_Size
$label2.TabIndex = 11
$label2.Text = "Citrix Farm Applications:"
$label2.add_Click($handler_label2_Click)

$form1.Controls.Add($label2)


$Uncheck_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 505
$Uncheck_app.Location = $System_Drawing_Point
$Uncheck_app.Name = "Unchech_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Uncheck_app.Size = $System_Drawing_Size
$Uncheck_app.TabIndex = 2
$Uncheck_app.Text = "Uncheck"
$Uncheck_app.UseVisualStyleBackColor = $True
$Uncheck_app.add_Click($uncheck_app_Click)

$form1.Controls.Add($Uncheck_app)

$Applications.DataBindings.DefaultDataSourceUpdateMode = 0
$Applications.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 87
$Applications.Location = $System_Drawing_Point
$Applications.Name = "Applications"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 300
$Applications.Size = $System_Drawing_Size
$Applications.TabIndex = 0
$Applications.add_SelectedIndexChanged($handler_checkedListBox1_SelectedIndexChanged)



    $n=0
    foreach($test in $apps)
    {
    $app=$apps[$n].ApplicationName
    [void] $Applications.Items.Add("$app")
    $n=$n+1
    }

$form1.Controls.Add($Applications)


$Check_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 95
$System_Drawing_Point.Y = 505
$Check_app.Location = $System_Drawing_Point
$Check_app.Name = "Check_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Check_app.Size = $System_Drawing_Size
$Check_app.TabIndex = 3
$Check_app.Text = "Check"
$Check_app.UseVisualStyleBackColor = $True
$Check_app.add_Click($Check_app_OnClick)

$form1.Controls.Add($Check_app)

#endregion Generated Form Code

#Save the initial state of the form
$InitialFormWindowState = $form1.WindowState
#Init the OnLoad event to correct the initial state of the form
$form1.add_Load($OnLoadForm_StateCorrection)
#Show the Form
$form1.ShowDialog()| Out-Null

} #End Function

#Call the Function
GenerateForm
