#Generated Form Function
$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
asnp Citrix.*

$x = @()
function GenerateForm {
########################################################################
# Code Generated By: SAPIEN Technologies PrimalForms (Community Edition) v1.0.10.0
# Generated On: 25/06/2015 11:03
# Generated By: Javier Vázquez Martín
########################################################################

#region Import the Assemblies
[reflection.assembly]::loadwithpartialname("System.Drawing") | Out-Null
[reflection.assembly]::loadwithpartialname("System.Windows.Forms") | Out-Null
#endregion

#region Generated Form Objects
$form1 = New-Object System.Windows.Forms.Form
$Refresh = New-Object System.Windows.Forms.Button
$Permisos = New-Object System.Windows.Forms.TabControl
$tabPage1 = New-Object System.Windows.Forms.TabPage
$label4 = New-Object System.Windows.Forms.Label
$Dom_group = New-Object System.Windows.Forms.TextBox
$Export_txt = New-Object System.Windows.Forms.Button
$Groups_app = New-Object System.Windows.Forms.TextBox
$Permissions_app = New-Object System.Windows.Forms.Button
$Remove = New-Object System.Windows.Forms.Button
$label1 = New-Object System.Windows.Forms.Label
$Add = New-Object System.Windows.Forms.Button
$tabPage2 = New-Object System.Windows.Forms.TabPage
$Servers_list = New-Object System.Windows.Forms.CheckedListBox
$Check_srv = New-Object System.Windows.Forms.Button
$label3 = New-Object System.Windows.Forms.Label
$Uncheck_srv = New-Object System.Windows.Forms.Button
$Publish = New-Object System.Windows.Forms.Button
$Unpublish = New-Object System.Windows.Forms.Button
$label2 = New-Object System.Windows.Forms.Label
$Unchech_app = New-Object System.Windows.Forms.Button
$Applications = New-Object System.Windows.Forms.CheckedListBox
$Check_app = New-Object System.Windows.Forms.Button
$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState
#endregion Generated Form Objects

#Import CSV with applications and permissions

If((Test-Path -path $scriptPath\apps.csv)) {
$apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
}
else {

    $nombrefile="apps.csv"
    $file = [string]"$scriptPath\$nombrefile"
    $filetemp = [string]"$scriptPath\app-listtemp.csv"
    Get-XAApplicationReport * | select @{n="ApplicationName";e={[string]::join(";", $_.Browsername)}}, @{n="UsersandGroups";e={[string]::join(";", $_.Accounts)}}|Export-Csv $file
    get-content $file |select -Skip 1 |set-content "$filetemp"
    move "$filetemp" $file -Force
    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
}

$servers=get-xaserver|sort-object Servername

    $n=0
    foreach($test in $servers)
    {
    $server=$servers[$n].Servername
    [void] $Servers_list.Items.Add("$server")
    $n=$n+1
    }


#----------------------------------------------
#Generated Event Script Blocks
#----------------------------------------------
#Provide Custom Code for events specified in PrimalForms.
$Export_txt_OnClick= 
{
#TODO: Place custom script here

}
$Export_txt_OnClick= 
{
        if ($permiso -ne $empty) {
	set-content -path $scriptpath\permissions.txt -value $permiso
        }
    
}

$Unpublish_OnClick= 
{
	foreach ( $objItem in $Applications.CheckedItems ) {
	   foreach ( $objItem2 in $Servers_list.CheckedItems ) {
           $app="$objItem"
		   $server="$objItem2"
	   	   Remove-XAApplicationServer -BrowserName $app -ServerNames $server
	   	   $message = "Server Removed to Application " + $groups + "`r`n"
	   	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x1)
	   }

	}

}

$handler_checkedListBox1_SelectedIndexChanged= 
{
#TODO: Place custom script here

}

$Uncheck_srv_OnClick= 
{
        for ($i=0;$i -lt $Servers_list.Items.count;$i++) {
            $Servers_list.SetItemchecked($i,$False)
        }
    
}

$uncheck_app_Click= 
{
        for ($i=0;$i -lt $Applications.Items.count;$i++) {
            $Applications.SetItemchecked($i,$False)
        }
    
}

$permission_app_Click= 
{

    $n=0
    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 
    $numero=$Applications.CheckedItems.count -1
    $permiso = (0 .. $numero)
    foreach ($objItem in $Applications.CheckedItems)
	{
	$app="$objItem"
	$groups = $apps|where {$_.ApplicationName -eq $app}|select UsersandGroups
	$grupo = $groups.UsersandGroups
	$permiso[$n] = "Application permissions " + $app + ": " + "`r`n" + $grupo + "`r`n" + "`r`n"
	$n = $n + 1
	}

    $Groups_app.Text = $permiso
    
}

$Add_Click= 
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    IF ($Dom_group.Text -lt 0) {
	$message = "Empty field" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
   	$wshell.Popup($message,0,"Write a group name",0x1)
	} else {
              $i=0
	      foreach ( $objItem in $Applications.CheckedItems ) {
	      $app="$objItem"
	      $groups = $Dom_group.Text
	      Add-XAApplicationAccount $app -accounts $groups -force
	      $applicationchecked[$i]=$app
              $i++
	      }
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"Added user/group " + $groups + " to applications " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x1)
    }
  
}

$Check_srv_OnClick= 
{
        for ($i=0;$i -lt $Servers_list.Items.count;$i++) {
            $Servers_list.SetItemchecked($i,$True)
        }
    
}

$Refresh_OnClick= 
{

    $nombrefile="apps.csv"
    $file = [string]"$scriptPath\$nombrefile"
    $filetemp = [string]"$scriptPath\app-listtemp.csv"
    Get-XAApplicationReport * | select @{n="ApplicationName";e={[string]::join(";", $_.Browsername)}}, @{n="UsersandGroups";e={[string]::join(";", $_.Accounts)}}|Export-Csv $file
    get-content $file |select -Skip 1 |set-content "$filetemp"
    move "$filetemp" $file -Force

    $apps = import-csv $scriptPath\apps.csv|sort-object ApplicationName 

    $message = "Farm Data has been updated"
    $wshell = New-Object -ComObject Wscript.Shell
    $wshell.Popup($message,0,"Done",0x1)
    
    $Applications.Items.clear()

    $n=0
    foreach($test in $apps)
    {
    $app=$apps[$n].ApplicationName
    [void] $Applications.Items.Add("$app")
    $n=$n+1
    }

    $Servers_list.Items.clear()
    
    $servers=get-xaserver|sort-object Servername

    $n=0
    foreach($test in $servers)
    {
    $server=$servers[$n].Servername
    [void] $Servers_list.Items.Add("$server")
    $n=$n+1
    }

}

$Publish_OnClick= 
{
	foreach ( $objItem in $Applications.CheckedItems ) {
	   foreach ( $objServer in $Servers_list.CheckedItems ) {
               $app="$objItem"
	       $server="$objServer"
	       Add-XAApplicationServer -BrowserName $app -ServerNames $server
	       $message = "Server " + $server + " added to Application " + $app + "`r`n"
	       $wshell = New-Object -ComObject Wscript.Shell
               $wshell.Popup($message,0,"Done",0x1)
	   }

	}
}

$Check_app_OnClick= 
{

        for ($i=0;$i -lt $Applications.Items.count;$i++) {
            $Applications.SetItemchecked($i,$True)
        }
    
}

$Remove_OnClick= 
{
    $appscheck = $Applications.CheckedItems
    $count=$appscheck.count
    $applicationchecked=(1..$count)
    IF ($Dom_group.Text -lt 0) {
	$message = "Empty field" + "`r`n"
	$wshell = New-Object -ComObject Wscript.Shell
   	$wshell.Popup($message,0,"Write a group name",0x1)
	} else {
        $i=0
        foreach ($objItem in $Applications.CheckedItems)
	    {
             $app="$objItem"
             $groups = $Dom_group.Text
	     $a = new-object -comobject wscript.shell
	     $Pregunta = $a.popup("Are you sure to remove permission in $app to the user/group?", 0,"Delete Files",4)
	     If ($Pregunta -eq 6) {
	      Remove-XAApplicationAccount $app -accounts $groups
	      $applicationchecked[$i]=$app
              $i++ 
	     }
	}
	   if ($i -eq 0){
	      $message = [string]"Cancelado"
	      $wshell = New-Object -ComObject Wscript.Shell
              $wshell.Popup($message,0,"Done",0x1)
           } else {
           $i--
	   $applicationchecked=$applicationchecked[0..$i]
	   $applicationchecked=$applicationchecked|out-string
	   $message = [string]"Added user/group " + $groups + " to applications " + "`r`n" + "$applicationchecked"
	   $wshell = New-Object -ComObject Wscript.Shell
           $wshell.Popup($message,0,"Done",0x1)
}
}
}

$OnLoadForm_StateCorrection=
{#Correct the initial state of the form to prevent the .Net maximized form issue
	$form1.WindowState = $InitialFormWindowState
}

#----------------------------------------------
#region Generated Form Code
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 662
$System_Drawing_Size.Width = 735
$form1.ClientSize = $System_Drawing_Size
$form1.DataBindings.DefaultDataSourceUpdateMode = 0
$form1.Name = "form1"
$form1.Text = "Citrix tool"


$Refresh.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 150
$System_Drawing_Point.Y = 553
$Refresh.Location = $System_Drawing_Point
$Refresh.Name = "Refresh"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 56
$System_Drawing_Size.Width = 162
$Refresh.Size = $System_Drawing_Size
$Refresh.TabIndex = 8
$Refresh.Text = "Refresh (It takes)"
$Refresh.UseVisualStyleBackColor = $True
$Refresh.add_Click($Refresh_OnClick)

$form1.Controls.Add($Refresh)

$Permisos.Appearance = 1
$Permisos.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 352
$System_Drawing_Point.Y = 12
$Permisos.Location = $System_Drawing_Point
$Permisos.Name = "Permisos"
$Permisos.SelectedIndex = 0
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 638
$System_Drawing_Size.Width = 364
$Permisos.Size = $System_Drawing_Size
$Permisos.TabIndex = 19

$form1.Controls.Add($Permisos)
$tabPage1.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$tabPage1.Location = $System_Drawing_Point
$tabPage1.Name = "tabPage1"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$tabPage1.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 609
$System_Drawing_Size.Width = 356
$tabPage1.Size = $System_Drawing_Size
$tabPage1.TabIndex = 0
$tabPage1.Text = "Users"
$tabPage1.UseVisualStyleBackColor = $True
$tabPage1.add_Click($handler_TabPage:_Click)

$Permisos.Controls.Add($tabPage1)
$label4.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 16
$label4.Location = $System_Drawing_Point
$label4.Name = "label4"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 100
$label4.Size = $System_Drawing_Size
$label4.TabIndex = 18
$label4.Text = "Application / Users"

$tabPage1.Controls.Add($label4)

$Dom_group.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 506
$Dom_group.Location = $System_Drawing_Point
$Dom_group.Name = "Dom_group"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 20
$System_Drawing_Size.Width = 300
$Dom_group.Size = $System_Drawing_Size
$Dom_group.TabIndex = 4

$tabPage1.Controls.Add($Dom_group)


$Export_txt.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 245
$System_Drawing_Point.Y = 552
$Export_txt.Location = $System_Drawing_Point
$Export_txt.Name = "Export_txt"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 56
$System_Drawing_Size.Width = 75
$Export_txt.Size = $System_Drawing_Size
$Export_txt.TabIndex = 9
$Export_txt.Text = "Export permissions to file"
$Export_txt.UseVisualStyleBackColor = $True
$Export_txt.add_Click($Export_txt_OnClick)

$tabPage1.Controls.Add($Export_txt)

$Groups_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 53
$Groups_app.Location = $System_Drawing_Point
$Groups_app.Multiline = $True
$Groups_app.Name = "Groups_app"
$Groups_app.ReadOnly = $True
$Groups_app.ScrollBars = 2
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 297
$Groups_app.Size = $System_Drawing_Size
$Groups_app.TabIndex = 1
$Groups_app.add_TextChanged($handler_textBox1_TextChanged)

$tabPage1.Controls.Add($Groups_app)


$Permissions_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 150
$System_Drawing_Point.Y = 552
$Permissions_app.Location = $System_Drawing_Point
$Permissions_app.Name = "Permissions_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 56
$System_Drawing_Size.Width = 75
$Permissions_app.Size = $System_Drawing_Size
$Permissions_app.TabIndex = 10
$Permissions_app.Text = "Permissions application report"
$Permissions_app.UseVisualStyleBackColor = $True
$Permissions_app.add_Click($permission_app_Click)

$tabPage1.Controls.Add($Permissions_app)


$Remove.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 585
$Remove.Location = $System_Drawing_Point
$Remove.Name = "Remove"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Remove.Size = $System_Drawing_Size
$Remove.TabIndex = 7
$Remove.Text = "Remove"
$Remove.UseVisualStyleBackColor = $True
$Remove.add_Click($Remove_OnClick)

$tabPage1.Controls.Add($Remove)

$label1.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 485
$label1.Location = $System_Drawing_Point
$label1.Name = "label1"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 18
$System_Drawing_Size.Width = 300
$label1.Size = $System_Drawing_Size
$label1.TabIndex = 5
$label1.Text = "Domain group or user (use with format Domain\login)"

$tabPage1.Controls.Add($label1)


$Add.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 552
$Add.Location = $System_Drawing_Point
$Add.Name = "Add"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Add.Size = $System_Drawing_Size
$Add.TabIndex = 6
$Add.Text = "Add"
$Add.UseVisualStyleBackColor = $True
$Add.add_Click($Add_Click)

$tabPage1.Controls.Add($Add)


$tabPage2.DataBindings.DefaultDataSourceUpdateMode = 0
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 4
$System_Drawing_Point.Y = 25
$tabPage2.Location = $System_Drawing_Point
$tabPage2.Name = "tabPage2"
$System_Windows_Forms_Padding = New-Object System.Windows.Forms.Padding
$System_Windows_Forms_Padding.All = 3
$System_Windows_Forms_Padding.Bottom = 3
$System_Windows_Forms_Padding.Left = 3
$System_Windows_Forms_Padding.Right = 3
$System_Windows_Forms_Padding.Top = 3
$tabPage2.Padding = $System_Windows_Forms_Padding
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 609
$System_Drawing_Size.Width = 356
$tabPage2.Size = $System_Drawing_Size
$tabPage2.TabIndex = 1
$tabPage2.Text = "Servers"
$tabPage2.UseVisualStyleBackColor = $True

$Permisos.Controls.Add($tabPage2)
$Servers_list.DataBindings.DefaultDataSourceUpdateMode = 0
$Servers_list.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 53
$Servers_list.Location = $System_Drawing_Point
$Servers_list.Name = "Servers_list"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 230
$Servers_list.Size = $System_Drawing_Size
$Servers_list.TabIndex = 12

$tabPage2.Controls.Add($Servers_list)


$Check_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 106
$System_Drawing_Point.Y = 471
$Check_srv.Location = $System_Drawing_Point
$Check_srv.Name = "Check_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 80
$Check_srv.Size = $System_Drawing_Size
$Check_srv.TabIndex = 14
$Check_srv.Text = "Check"
$Check_srv.UseVisualStyleBackColor = $True
$Check_srv.add_Click($Check_srv_OnClick)

$tabPage2.Controls.Add($Check_srv)

$label3.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 20
$label3.Location = $System_Drawing_Point
$label3.Name = "label3"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 100
$label3.Size = $System_Drawing_Size
$label3.TabIndex = 17
$label3.Text = "Servers:"

$tabPage2.Controls.Add($label3)


$Uncheck_srv.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 20
$System_Drawing_Point.Y = 471
$Uncheck_srv.Location = $System_Drawing_Point
$Uncheck_srv.Name = "Uncheck_srv"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 80
$Uncheck_srv.Size = $System_Drawing_Size
$Uncheck_srv.TabIndex = 13
$Uncheck_srv.Text = "Uncheck"
$Uncheck_srv.UseVisualStyleBackColor = $True
$Uncheck_srv.add_Click($Uncheck_srv_OnClick)

$tabPage2.Controls.Add($Uncheck_srv)


$Publish.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 265
$System_Drawing_Point.Y = 169
$Publish.Location = $System_Drawing_Point
$Publish.Name = "Publish"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 75
$Publish.Size = $System_Drawing_Size
$Publish.TabIndex = 15
$Publish.Text = "Publish"
$Publish.UseVisualStyleBackColor = $True
$Publish.add_Click($Publish_OnClick)

$tabPage2.Controls.Add($Publish)


$Unpublish.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 265
$System_Drawing_Point.Y = 198
$Unpublish.Location = $System_Drawing_Point
$Unpublish.Name = "Unpublish"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 75
$Unpublish.Size = $System_Drawing_Size
$Unpublish.TabIndex = 16
$Unpublish.Text = "Unpublish"
$Unpublish.UseVisualStyleBackColor = $True
$Unpublish.add_Click($Unpublish_OnClick)

$tabPage2.Controls.Add($Unpublish)



$label2.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 54
$label2.Location = $System_Drawing_Point
$label2.Name = "label2"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 19
$System_Drawing_Size.Width = 160
$label2.Size = $System_Drawing_Size
$label2.TabIndex = 11
$label2.Text = "Citrix Farm Applications:"
$label2.add_Click($handler_label2_Click)

$form1.Controls.Add($label2)


$Unchech_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 505
$Unchech_app.Location = $System_Drawing_Point
$Unchech_app.Name = "Unchech_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Unchech_app.Size = $System_Drawing_Size
$Unchech_app.TabIndex = 2
$Unchech_app.Text = "Uncheck"
$Unchech_app.UseVisualStyleBackColor = $True
$Unchech_app.add_Click($uncheck_app_Click)

$form1.Controls.Add($Unchech_app)

$Applications.DataBindings.DefaultDataSourceUpdateMode = 0
$Applications.FormattingEnabled = $True
$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 10
$System_Drawing_Point.Y = 87
$Applications.Location = $System_Drawing_Point
$Applications.Name = "Aplications"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 409
$System_Drawing_Size.Width = 300
$Applications.Size = $System_Drawing_Size
$Applications.TabIndex = 0
$Applications.add_SelectedIndexChanged($handler_checkedListBox1_SelectedIndexChanged)

    $n=0
    foreach($test in $apps)
    {
    $app=$apps[$n].ApplicationName
    [void] $Applications.Items.Add("$app")
    $n=$n+1
    }

$form1.Controls.Add($Applications)


$Check_app.DataBindings.DefaultDataSourceUpdateMode = 0

$System_Drawing_Point = New-Object System.Drawing.Point
$System_Drawing_Point.X = 97
$System_Drawing_Point.Y = 505
$Check_app.Location = $System_Drawing_Point
$Check_app.Name = "Check_app"
$System_Drawing_Size = New-Object System.Drawing.Size
$System_Drawing_Size.Height = 23
$System_Drawing_Size.Width = 79
$Check_app.Size = $System_Drawing_Size
$Check_app.TabIndex = 3
$Check_app.Text = "Check"
$Check_app.UseVisualStyleBackColor = $True
$Check_app.add_Click($Check_app_OnClick)


$form1.Controls.Add($Check_app)

#endregion Generated Form Code

#Save the initial state of the form
$InitialFormWindowState = $form1.WindowState
#Init the OnLoad event to correct the initial state of the form
$form1.add_Load($OnLoadForm_StateCorrection)
#Show the Form
$form1.ShowDialog()| Out-Null

} #End Function

#Call the Function
GenerateForm
